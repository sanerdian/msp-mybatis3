<title>基本信息</title>
<style>
  #nav span,.right span{display: none;}
  #nav a{display: inline-block;width: 40px;height: 56px;text-align: center;border: 1px solid #f5f5f5;}
  #nav a:nth-of-type(3){display: inline-block;width: 170px;height: 52px; text-align: left;padding-left: 20px;border-top: 2px solid #000;font-weight: bold;}
  .right{display: inline-block;position: absolute;top: 0;right: 0;}
  .layui-breadcrumb a{color: #000!important;}
</style>

<div class="layui-card layadmin-header">
  <div class="layui-breadcrumb" lay-filter="breadcrumb" id="nav">
    <a><i class="layui-icon layui-icon-prev"></i></a>
    <a lay-href=''><i class="layui-icon layui-icon-home"></i></a>
    <a>基本信息<i class="layui-icon layui-icon-close" style="margin-left: 50px"></i></a>
    <div class="right">
      <a><i class="layui-icon layui-icon-next"></i></a>
      <a><i class="layui-icon layui-icon-down"></i></a>
    </div>
  </div>
</div>

<div class="layui-fluid">
  <div class="layui-row layui-col-space15">
    <div class="layui-col-md12">
      <div class="layui-card">
        <div class="layui-card-header">基本信息</div>
        <div class="layui-card-body" id="baseContent" pad15>

          <!--<div class="layui-form" lay-filter="">-->
            <!--<div class="layui-form-item">-->
              <!--<label class="layui-form-label">我的角色</label>-->
              <!--<div class="layui-input-inline">-->
                <!--<select name="role" lay-verify="">-->
                  <!--<option value="1" selected>超级管理员</option>-->
                  <!--<option value="2" disabled>普通管理员</option>-->
                  <!--<option value="3" disabled>审核员</option>-->
                  <!--<option value="4" disabled>编辑人员</option>-->
                <!--</select>-->
              <!--</div>-->
              <!--<div class="layui-form-mid layui-word-aux">当前角色不可更改为其它角色</div>-->
            <!--</div>-->
            <!--<div class="layui-form-item">-->
              <!--<label class="layui-form-label">用户名</label>-->
              <!--<div class="layui-input-inline">-->
                <!--<input type="text" name="username" value="xianxin" readonly class="layui-input">-->
              <!--</div>-->
              <!--<div class="layui-form-mid layui-word-aux">不可修改。一般用于后台登录名</div>-->
            <!--</div>-->
            <!--<div class="layui-form-item">-->
              <!--<label class="layui-form-label">昵称</label>-->
              <!--<div class="layui-input-inline">-->
                <!--<input type="text" name="nickname" value="贤心" lay-verify="nickname" autocomplete="off" placeholder="请输入昵称" class="layui-input">-->
              <!--</div>-->
            <!--</div>-->
            <!--<div class="layui-form-item">-->
              <!--<label class="layui-form-label">性别</label>-->
              <!--<div class="layui-input-block">-->
                <!--<input type="radio" name="sex" value="男" title="男">-->
                <!--<input type="radio" name="sex" value="女" title="女" checked>-->
              <!--</div>-->
            <!--</div>-->
            <!--<div class="layui-form-item">-->
              <!--<label class="layui-form-label">头像</label>-->
              <!--<div class="layui-input-inline">-->
                <!--<input name="avatar" lay-verify="required" id="LAY_avatarSrc" placeholder="图片地址" value="http://cdn.layui.com/avatar/168.jpg" class="layui-input">-->
              <!--</div>-->
              <!--<div class="layui-input-inline layui-btn-container" style="width: auto;">-->
                <!--<button type="button" class="layui-btn layui-btn-primary" id="LAY_avatarUpload">-->
                  <!--<i class="layui-icon">&#xe67c;</i>上传图片-->
                <!--</button>-->
                <!--<button class="layui-btn layui-btn-primary" layadmin-event="avartatPreview">查看图片</button >-->
              <!--</div>-->
            <!--</div>-->
            <!--<div class="layui-form-item">-->
              <!--<label class="layui-form-label">手机</label>-->
              <!--<div class="layui-input-inline">-->
                <!--<input type="text" name="cellphone" value="" lay-verify="phone" autocomplete="off" class="layui-input">-->
              <!--</div>-->
            <!--</div>-->
            <!--<div class="layui-form-item">-->
              <!--<label class="layui-form-label">邮箱</label>-->
              <!--<div class="layui-input-inline">-->
                <!--<input type="text" name="email" value="" lay-verify="email" autocomplete="off" class="layui-input">-->
              <!--</div>-->
            <!--</div>-->
            <!--<div class="layui-form-item layui-form-text">-->
              <!--<label class="layui-form-label">备注</label>-->
              <!--<div class="layui-input-block">-->
                <!--<textarea name="remarks" placeholder="请输入内容" class="layui-textarea"></textarea>-->
              <!--</div>-->
            <!--</div>-->
            <!--<div class="layui-form-item">-->
              <!--<div class="layui-input-block">-->
                <!--<button class="layui-btn" lay-submit lay-filter="setmyinfo">确认修改</button>-->
                <!--<button type="reset" class="layui-btn layui-btn-primary">重新填写</button>-->
              <!--</div>-->
            <!--</div>-->
          <!--</div>-->

        </div>
      </div>
    </div>
  </div>
</div>
<script type="text/html" id="infoTempl">
  <form class="layui-form" lay-filter="info">
    <div class="layui-form-item">
      <label class="layui-form-label">用户名：</label>
      <div class="layui-input-inline">
        <input type="text" name="name" value="{{d.name}}" readonly class="layui-input">
      </div>
      <div class="layui-form-mid layui-word-aux">不可修改。一般用于后台登录名</div>
    </div>
    <div class="layui-form-item">
      <label class="layui-form-label">昵称：</label>
      <div class="layui-input-inline">
        <input type="text" name="nickName" value="{{d.nickName}}" lay-verify="nickname" autocomplete="off" placeholder="请输入昵称" class="layui-input">
      </div>
    </div>
    <div class="layui-form-item">
      <label class="layui-form-label">性别：</label>
      <div class="layui-input-block">
        {{#if(d.sex==='男'){ }}
        <input type="radio" name="sex" value="男" title="男" checked>
        <input type="radio" name="sex" value="女" title="女" >
        {{# }else{ }}
        <input type="radio" name="sex" value="男" title="男" >
        <input type="radio" name="sex" value="女" title="女" checked>
        {{# } }}
      </div>
    </div>
    <!--<div class="layui-form-item">-->
      <!--<label class="layui-form-label">头像</label>-->
      <!--<div class="layui-input-inline">-->
        <!--<input name="headUrl" lay-verify="required" id="LAY_avatarSrc" placeholder="图片地址" value="{{d.headUrl}}" class="layui-input">-->
      <!--</div>-->
      <!--<div class="layui-input-inline layui-btn-container" style="width: auto;">-->
        <!--<button type="button" class="layui-btn layui-btn-primary" id="LAY_avatarUpload">-->
          <!--<i class="layui-icon">&#xe67c;</i>上传图片-->
        <!--</button>-->
        <!--&lt;!&ndash;<button class="layui-btn layui-btn-primary" layadmin-event="avartatPreview">查看图片</button >&ndash;&gt;-->
      <!--</div>-->
    <!--</div>-->
    <div class="layui-form-item">
      <label class="layui-form-label">头像：</label>
      <div class="layui-upload" style="float:left;">
        <input type="hidden" class="layui-upload-img" name="headUrl" value="{{d.headUrl}}">
<!--        <img  id="demo1" width="92px" height="92px" src="{{getAjaxUrl('',d.headUrl)}}">-->
        <img  id="demo1" width="92px" height="92px" src="{{d.headUrl}}">
        <button type="button" class="layui-btn" id="uploadHead" style="float: right;margin-top: 55px; margin-left: 5px">上传图片</button>
      </div>
    </div>
    <div class="layui-form-item">
      <label class="layui-form-label">手机：</label>
      <div class="layui-input-inline">
        <input type="text" name="mobile" value="{{d.mobile}}" lay-verify="phone" autocomplete="off" class="layui-input">
      </div>
    </div>
    <div class="layui-form-item">
      <label class="layui-form-label">邮箱：</label>
      <div class="layui-input-inline">
        <input type="text" name="email" value="{{d.email}}" lay-verify="email" autocomplete="off" class="layui-input">
      </div>
    </div>
    <div class="layui-form-item layui-form-text">
      <label class="layui-form-label">备注：</label>
      <div class="layui-input-inline" style="width:80%;">
        <textarea name="describe"  placeholder="请输入内容" class="layui-textarea">{{d.describe}}</textarea>
      </div>
    </div>
    <div class="layui-form-item">
      <div class="layui-input-block">
        <button class="layui-btn"  type="button" lay-submit lay-filter="setmyinfo">确认修改</button>
        <button type="reset" class="layui-btn layui-btn-primary" lay-submit lay-filter="reset" >重新填写</button>
      </div>
    </div>
    <input type="hidden" name="id" value="{{d.id}}">
  </form>
</script>
<script>

  $(function () {
      baseInfo();
  })


  layui.form.on('submit(setmyinfo)',function (data) {
      console.log(JSON.stringify(data.field))
      var type="put";
      var url="/user/updateBaseInfo";
      var data=JSON.stringify(data.field);
      ajax(service_prefix.member,url,type,data).then(res=>{
           baseInfo()
      }).catch(res=>{

      })
     return false;
  })
  layui.form.on('submit(reset)',function (data) {
      ajax(service_prefix.member,'/user/getBaseInfo','post').then(function (res) {
          console.log(res.obj)
          layui.form.val("info",{'crUser':res.obj.crUser,"nickName":"",'sex':"","headUrl":"","mobile":"","email":"","describe":""})
      })

      return false;
  })

  //获取登陆用户基本信息
  function baseInfo() {
      ajax(service_prefix.member,"/user/getBaseInfo","post").then(function (data){
          if(data.success){
              layui.laytpl($("#infoTempl").html()).render(data.obj,function(html){
                  $("#baseContent").html(html);
                  layui.form.render();
              })
              layui.upload.render({
                  elem: '#uploadHead'
                  // ,url: '/user/importHead'
                  ,url: getAjaxUrl(service_prefix.member,'/user/importHead?id=123')
                  ,before: function(obj){
                      //预读本地文件示例，不支持ie8
                      obj.preview(function(index, file, result){
                          $('#demo1').attr('src', result); //图片链接（base64）
                      });
                  }
                  ,done: function(res){
                      //如果上传失败
                      if(!res.success){
                          return layer.msg('上传失败');
                      }
                      //上传成功
                      $("[name=headUrl]").val(res.obj.url)
                  }
                  ,error: function(){
                      //演示失败状态，并实现重传
                      var demoText = $('#demoText');
                      demoText.html('<span style="color: #FF5722;">上传失败</span> <a class="layui-btn layui-btn-xs demo-reload">重试</a>');
                      demoText.find('.demo-reload').on('click', function(){
                          uploadInst.upload();
                      });
                  }
              });
          }
      })
  }
</script>