<style>
    .uls li {
        width: 181px;
        height: 184px;
        border: 1px solid rgba(228, 228, 228, 1);
        margin: 0px 0px 20px 37px;
        position: relative;
        display: inline-block;
        z-index: 1;
    }

    .uls li:nth-child(6n-5) {
        margin-left: 0px;
    }

    .uls .layui-form-checkbox[lay-skin=primary] i {
        left: -90px;
    }

    .uls li form {
        width: 181px;
        height: 144px;
        background: url("common/img/u7159.png") no-repeat center center;
        background-size: 50% 50%;
        position: absolute;
        top: 0;
        left: 0;
    }

    .chanelName {
        text-align: center;
        line-height: 133px;
        font-size: 18px;
        font-weight: bolder;
    }


    .layui-btn:nth-of-type(2) {
        margin-left: 10px;
    }

    #import,
    #export {
        display: inline-block;
    }

    #info tr td:first-child {
        text-align: right;
        background: #fcfcfc;
    }

    #info tr td:last-child {
        background: #ffffff;
    }

    #info tr td {
        border: 1px solid #e7e7e7;
    }

    #info tr td input {
        margin-left: 3px;
    }

    .kinds span {
        margin-right: 18px;
        cursor: pointer;
    }

    .kinds .active {
        font-weight: 700;
        font-style: normal;
        font-size: 16px;
        color: #009688;
    }

    .layui-table-cell .layui-form-checkbox[lay-skin=primary] {
        height: 48px;
    }

    .uls li:last-child button {
        border: none;
        background: url("common/img/u5320.png") no-repeat center center;
        position: absolute;
        left: 50%;
        top: 50%;
        transform: translateX(-50%) translateY(-50%);
    }

    .layui-form [lay-ignore] {
        width: 86px;
        height: 24px;
        margin-top: -5px;
    }

    #item .layui-table-view {
        margin-left: 0px;
    }

    #state input {
        margin: 20px;
    }

    .radio p {
        height: 30px;
    }

    #task label {
        display: block;
        margin-top: 10px;
    }

    #task label select, #hotwords label select {
        background: #ffffff;
        color: #000;
        height: 25px;
        position: relative;
    }

    #openDiv .layui-this {
        background-color: #009688;
        color: white;
    }

    #openDiv .layui-tab-title li:hover {
        background-color: #009688;
        color: white;
    }

    .layui-card .layui-tab {
        border: none;
        box-shadow: none;
    }

    #openDiv .layui-tab {
        margin: 0;
        border: none;
        box-shadow: none;
    }

    #openDiv table {
        margin: 0;
    }

    .search-bar {
        padding-bottom: 10px;
    }

    .layui-input-block span {
        line-height: 38px;
    }

    #searchForm .layui-form-item {
        margin-bottom: 5px;
    }
    .kinds {
        margin-bottom: 10px;
        margin-top: 5px;
    }
    .form-item-inline {
        display: inline-block;
    }
    .layui-colla-icon {left: 290px;}
    .layui-colla-title{background-color: white;}
    .layui-colla-title img{position: absolute;top:13px;}
</style>

<div class="layui-fluid">
    <div class="layui-col-md3 md2-left">
        <div class="layui-card h100">
            <div class="layui-card-header">
                <div class="layui-col-md2">站点</div>
            </div>
            <div id="siteTree" class="ztree">
            </div>
        </div>
    </div>
    <div class="layui-col-md9 md2-right h100">
        <div class="layui-card h100">
                <div class="layui-tab layui-tab-card h100">
                    <div class="layui-tab-content jnet-tab-content">
                        <div class="layui-card layui-tab-item layui-show">
                            <div class="layui-card-header">模板</div>
                            <div class="layui-card-body">
                                <div class="search-bar ">
                                    <button class="layui-btn layui-btn-primary layui-btn-sm layuiadmin-btn-admin" data-type="add">新建模板</button>
                                    <button class="layui-btn layui-btn-primary layui-btn-sm layuiadmin-btn-admin" data-type="del">删除模板</button>
                                    <button class="layui-btn layui-btn-primary layui-btn-sm layuiadmin-btn-admin jnet-import-btn" id="importTemplate">导入模板</button>
                                    <button class="layui-btn layui-btn-primary layui-btn-sm layuiadmin-btn-admin" onclick="exportTemplate()">导出模板</button>
                                    <!--<form class="layui-form" action="" style="float: right;">
                                        <input type="text" name="title" placeholder="请输入模板名称" autocomplete="off" class="layui-input search-input" id="val">
                                        <button class="layui-btn" type="button" onclick="doList()"><i class="layui-icon">&#xe615;</i></button>
                                    </form>-->
                                    <form>
                                        <div class="layui-inline jnet-search-right">
                                            <input type="text" id="val" placeholder="请输入模板名称" class="layui-input">
                                        </div>
                                        <button type="button" onclick="doList()"  class="layui-btn layui-btn-sm layui-inline"><img src="common/img/u11881.svg"></button>
                                        <button type="button" class="layui-btn layui-btn-sm layui-inline layui-btn-primary" onclick="showSearchBody()"><img src="common/img/u11999.svg"></button>
                                    </form>
                                </div>
                                <div class="kinds">
                                    <span class="active" data_type="">全部模板</span>
                                    <span data_type="1">概览模板</span>
                                    <span data_type="2">细览模板</span>
                                    <span data_type="3">嵌套模板</span>
                                    <span data_status="0">已被使用的</span>
                                    <span data_status="1">未被使用的</span>
                                </div>
                                <div>
                                    <table class="layui-hide" id="templateList" lay-filter="demo1"></table>
                                </div>
                                <div id="page1"></div>
                            </div>
                            <div class="layui-card jnet-search-body">
                                <div class="layui-card-header"><div class="layui-col-md5">筛选</div><div class="layui-col-md7"><img onclick="closeSearchBody()" src="common/img/u11915.svg" style="float: right; margin-top: 15px;cursor: pointer;"></div></div>
                                <div class="layui-card-body">
                                    <form class="layui-form">
                                        <div class="layui-row">
                                            模板名称
                                        </div>
                                        <div class="layui-row">
                                            <input class="layui-input" type="text" name="tempname">
                                        </div>
                                        <div class="layui-form-item">
                                            网页类型
                                        </div>
                                        <div class="layui-row" >
                                            <select name="temptype" id = "temptype1" lay-filter = "temptype1"  style="display: none">
                                                <option value="">请选择</option>
                                                <option value="1">概览模板</option>
                                                <option value="2">细览模板</option>
                                                <option value="3">嵌套模板</option>
                                            </select>
                                        </div>
                                        <div class="layui-form-item">
                                            模板类型
                                        </div>
                                        <div class="layui-row">
                                                <input class="layui-input" type="text" name="modifyUser">
                                            <!--<select name="tpltype" id = "tpltype1" lay-filter = "tpltype1" >
                                                <option value="">请选择</option>
                                                <option value="1">动态模板</option>
                                                <option value="2">静态模板</option>
                                            </select>-->
                                        </div>
                                        <div class="layui-row-item">
                                            操作人
                                        </div>
                                        <div class="layui-row">
                                            <input class="layui-input" type="text" name="modifyUser">
                                        </div>
                                        <div class="layui-row-item">
                                            操作人时间
                                        </div>
                                        <div class="layui-row">
                                            <input class="layui-input jnet-search-crtime" type="text" name="modifyTime">
                                        </div>
                                        <div class="layui-row-item">
                                            创建人
                                        </div>
                                        <div class="layui-row">
                                            <input class="layui-input" type="text" name="crUser">
                                        </div>
                                        <div class="layui-row-item">
                                            创建时间
                                        </div>
                                        <div class="layui-row">
                                            <input class="layui-input jnet-search-crtime" type="text" name="createTime">
                                        </div>
                                        <div class="jnet-submit-bar">
                                            <button class="layui-btn layui-btn-sm" lay-submit lay-filter="searchTable">确定</button>
                                            <button type="reset" class="layui-btn layui-btn-primary layui-btn-sm">重置</button>
                                        </div>
                                    </form>
                                </div>
                            </div>
                        </div>
                        <div class="layui-tab-item">
                            <div class="layui-card-header">公共JS</div>
                            <div class="layui-card-body">
                                <div class="search-bar">
                                    <button class="layui-btn layui-btn-primary layui-btn-sm layuiadmin-btn-admin" onclick="addCommon('js')">新建JS</button>
                                    <button class="layui-btn layui-btn-primary layui-btn-sm layuiadmin-btn-admin" onclick="delCommon('js')">删除JS</button>
                                    <button class="layui-btn layui-btn-primary layui-btn-sm layuiadmin-btn-admin jnet-import-btn" id="importJs">导入JS</button>
                                    <button class="layui-btn layui-btn-primary layui-btn-sm layuiadmin-btn-admin" >导出JS</button>
                                    <button class="layui-btn layui-btn-primary layui-btn-sm layuiadmin-btn-admin" onclick="pubCommon('js')">发布JS</button>
                                </div>
                                <div><table class="layui-hide" id="jsList" lay-filter="jsList"></table></div>
                                <div id="jsPage"></div>
                            </div>
                        </div>                 
                        <div class="layui-tab-item">
                            <div class="layui-card-header">公共CSS</div>
                            <div class="layui-card-body">
                                <div class="search-bar">
                                    <button class="layui-btn layui-btn-primary layui-btn-sm layuiadmin-btn-admin" onclick="addCommon('css')">新建CSS</button>
                                    <button class="layui-btn layui-btn-primary layui-btn-sm layuiadmin-btn-admin" onclick="delCommon('css')">删除CSS</button>
                                    <button class="layui-btn layui-btn-primary layui-btn-sm layuiadmin-btn-admin jnet-import-btn" id="importCss">导入CSS</button>
                                    <button class="layui-btn layui-btn-primary layui-btn-sm layuiadmin-btn-admin" >导出CSS</button>
                                    <button class="layui-btn layui-btn-primary layui-btn-sm layuiadmin-btn-admin" onclick="pubCommon('css')">发布CSS</button>
                                </div>
                                <div><table class="layui-hide" id="cssList" lay-filter="cssList"></table></div>
                                <div id="cssPage"></div>
                            </div>
                        </div>
                        <div class="layui-tab-item">
                            <div class="layui-card-header">公共IMG</div>
                                <div class="layui-card-body">
                                <div class="search-bar">
                                    <button class="layui-btn layui-btn-primary layui-btn-sm layuiadmin-btn-admin jnet-import-btn" id="importImg">导入IMG</button>
                                    <button class="layui-btn layui-btn-primary layui-btn-sm layuiadmin-btn-admin" >导出IMG</button>
                                    <button class="layui-btn layui-btn-primary layui-btn-sm layuiadmin-btn-admin" onclick="delCommon('img')">删除IMG</button>
                                    <button class="layui-btn layui-btn-primary layui-btn-sm layuiadmin-btn-admin" onclick="pubCommon('img')">发布IMG</button>
                                </div>
                                <div><table class="layui-hide" id="imgList" lay-filter="imgList"></table></div>
                                <div id="imgPage"></div>
                            </div>
                        </div>
                    </div>
                    <ul class="layui-tab-title jnet-tab-title">
                        <li class="layui-this">模板</li>
                        <li>公共JS</li>
                        <li>公共CSS</li>
                        <li>IMG文件</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
    <div class="layui-row layui-col-space12" id="addMetadataView" style="display:none;">
        <div class="layui-card h100" id="addMetadataBody">
        </div>
    </div>
</div>

<script type="text/html" id="templetTpl">
    <form class="layui-form" lay-filter="templetForm">
        <div class="layui-card">
            <div class="layui-card-body" style="padding: 25px 15px;    height: 780px;">

                <div class="layui-form-item form-item-inline" style="width: 500px">
                    <label class="layui-form-label">模板名称:</label>
                    <div class="layui-input-block">
                        <input type="text" id="tempName" name="tempname" placeholder="请输入" autocomplete="off" class="layui-input">
                    </div>
                </div>
                <div class="layui-form-item form-item-inline">
                    <label class="layui-form-label">网页类型:</label>
                    <div class="layui-input-block">
                        <select name="temptype" id="tempType" class="layui-input" required lay-verify="required">
                            <option value="1">概览模板</option>
                            <option value="2">细览模板</option>
                            <option value="3">嵌套模板</option>
                        </select>
                    </div>
                </div>
                <div class="layui-form-item form-item-inline">
                    <label class="layui-form-label">输出文件名:</label>
                    <div class="layui-input-block">
                        <input type="text" name="outputfilename" placeholder="请输入" autocomplete="off" class="layui-input">
                    </div>
                </div>
                <div class="layui-form-item form-item-inline">
                    <label class="layui-form-label">扩展名:</label>
                    <div class="layui-input-block">
                        <input type="text" name="tempext" placeholder="请输入" autocomplete="off" class="layui-input">
                    </div>
                </div>
                <div class="layui-form-item form-item-inline">
                    <label class="layui-form-label">模板类型:</label>
                    <div class="layui-input-block">
                        <select name="tpltype" id="tpltype" class="layui-input" required lay-verify="required">
                            <option value="2">动态模板</option>
                            <option value="1">静态模板</option>
                        </select>
                    </div>
                </div>
                <div class="layui-form-item" >
                    <label class="layui-form-label">模板描述:</label>
                    <div class="layui-input-block" style="display: inline-block;margin-left: 0">
                        <textarea class="layui-textarea" style="height: 55px;min-height: 0;width: 1010px;" name="tempdesc"></textarea>
                    </div>
                    <div class="layui-upload" style="    position: absolute;display: inline-block;
    margin-left: 50px;
    margin-top: 12px;">
                        <input type="hidden" class="layui-upload-img" name="thumbnail"  >
                        <button type="button" class="layui-btn" id="uploadTemplate" style="display: inline-block">上传模板缩略图</button>
                        <div class="layui-upload-list" style="display: inline-block;position: absolute;
    left: 140px;
    top: -20px;    height: 50px;
    width: 120px;
    border: 1px solid;
    margin-left: 10px">
                            <img class="layui-upload-img" id="demos1" style="width: 100%;height: 100%" >
                            <p id="demoText"></p>
                        </div>
                    </div>
                </div>
                <div class="layui-form-item">
                    <label class="layui-form-label">模板文本:</label>
                    <div class="layui-input-block">
                        <textarea class="layui-textarea" style="height: 673px;padding-top: 7px;line-height: 18px!important;" name="temphtml" id="text1"></textarea>
                    </div>
                </div>

            </div>
        </div>
        <div class="button-bar">
            <button class="layui-btn" lay-submit lay-filter="addTemplet">提交</button>
            <button class="layui-btn" type="button" data-type="close">返回</button>
        </div>
        <input type="hidden" name="id">
        <input type="hidden" name="siteid">
    </form>
</script>

<script>
    var path="";

    $(function(){
        $(".kinds span").on("click",function(){
            $(this).addClass("active").siblings().removeClass("active");
            doList();
        })
    })
    function tempType(){
        return $(".kinds span.active").attr("data_type")
    }
    //模板列表
    function doList(pageNo,size,searchObj) {
        if(!pageNo) pageNo = 1;
        if(!size) size = 15;
        if(!searchObj){
        var jsondata = {
            "pager": {
                "current": pageNo,
                "size": size,
                sortProps:[{
                    key:"createTime",value:false
                }]
            },
            entity: {
                tempname:$("#val").val(),temptype:tempType(),/*status:$(".kinds .active").attr("data_type"),*/siteid:siteId()
            }
        }}else {
            var jsondata = {

                "pager": {
                    "current": pageNo,
                    "size": size,
                    sortProps:[{
                        key:"createTime",value:false
                    }]
                },
                entity: {
                    tempname:searchObj.tempname,temptype:searchObj.temptype,tpltype:searchObj.tpltype,
                    modifyUser:searchObj.modifyUser,modifyTime:searchObj.modifyTime
                    ,modifyTimeto:searchObj.modifyTimeto, crUser:searchObj.crUser,
                    createTime:searchObj.createTime,crtimeTo:searchObj.crtimeTo,siteid:siteId()
                }
            }
        }
        ajax(service_prefix.manage,"/template/list","post",JSON.stringify(jsondata)).then(data => {
            if (data.success) {
                var cols = [
                    {type: 'checkbox', field: "id"}
                    , {type: 'numbers', title: '序号', align: "center"}
                    , {field: 'tempname', title: '模板名称', align: "left", event:"edit"}
                    , {field: 'temptype',title: '网页类型', templet: "<div><span>{{d.temptype==1?'概览模板':d.temptype==2?'细览模板':'嵌套模板'}}</span></div>"}
                    , {field: 'tpltype', title: '模板类型', templet: '<div><span>{{d.tpltype==2?"动态模板":"静态模板"}}</span></div>'}
                    , {field: '', title: '预览', templet:'<div><img lay-event="look" src="common/img/u36587.svg"></div>', width: 80, align:"center", fixed: 'right'}
                ];
                renderRightTable("templateList",cols,data.obj.records,$(".jnet-tab-content .layui-card-body").height()-120)
                layui.table.on('tool(demo1)', function (obj) {
                    var data = obj.data;
                    if (obj.event === 'edit') {
                        edit(data.id);
                    }else  if(obj.event=== 'look'){
                        window.open(data.thumbnail)
                    }
                });
                loadPage2('page1', data.obj, doList);
            }
        })
    }
    function showSearchBody(){
        $(".jnet-search-body").show();
    }

    function closeSearchBody(){
        $(".jnet-search-body").hide();
    }

    layui.laydate.render({
        elem: '.jnet-search-crtime'
        , range: true
    });
    layui.form.on("submit(searchTable)",function(data){
            var time1 = data.field.createTime;
            var time2 = data.field.modifyTime
            var times = time1.split(" - ");
            var time2s = time2.split(" - ");
            data.field.crtimeTo = times[1];
            data.field.createTime = times[0];
            data.field.modifyTime = time2s[0];
            data.field.modifyTimeto = time2s[1];
            searchObj = data.field;
           doList(1,15,searchObj);
            return false;
    })

    function add(){
        if(!siteId()){
            layer.msg("请选择站点!");
            return false;
        }
        layerOpenFull("新建模板");
        lodTpl("templetTpl", "openDiv", {siteName:siteName});
        $("#text1").initTextarea();

        layui.form.val("templetForm",{siteid:siteId()});
        layui.use('upload', function(){
            var $ = layui.jquery
                ,upload = layui.upload;

            //普通图片上传
            var uploadInst = upload.render({
                elem: '#uploadTemplate'
                ,url: 'resources/picture/upload?id=1190189815098888194'
                ,before: function(obj){
                    //预读本地文件示例，不支持ie8
                    obj.preview(function(index, file, result){
                        $('#demos1').attr('src', result); //图片链接（base64）
                    });
                }
                ,done: function(res){

                    $("[name=thumbnail]").val(res.url)
                }
                ,error: function(){

                }
            });
        });
    }
    function edit(id) {
        if(!id) id = getTableEdit("idTest").id;
        ajax(service_prefix.manage,"/template/"+id,"get").then(res => {
            var data = res.obj;
            if(data.siteid){
                ajax(service_prefix.manage,"/site/"+data.siteid,"get",{}).then(res => {
                    if(res.success){
                        layerOpenFull("修改模板");
                        lodTpl("templetTpl", "openDiv", {siteName:res.obj.name});
                        $("#text1").initTextarea();
                        layui.form.val("templetForm",data);
                        layui.use('upload', function(){
                            var $ = layui.jquery
                                ,upload = layui.upload;

                            //普通图片上传
                            var uploadInst = upload.render({
                                elem: '#uploadTemplate'
                                ,url: 'resources/picture/upload?id=1190189815098888194'
                                ,before: function(obj){
                                    //预读本地文件示例，不支持ie8
                                    obj.preview(function(index, file, result){
                                        $('#demos1').attr('src', result); //图片链接（base64）
                                    });
                                }
                                ,done: function(res){
                                    $("[name=thumbnail]").val(res.url)
                                }
                                ,error: function(){

                                }
                            });
                        });
                    }else{
                        layerOpenFull("修改模板");
                        lodTpl("templetTpl", "openDiv", {siteName:""});
                        $("#text1").initTextarea();
                        layui.form.val("templetForm",data);
                        layui.use('upload', function(){
                            var $ = layui.jquery
                                ,upload = layui.upload;

                            //普通图片上传
                            var uploadInst = upload.render({
                                elem: '#uploadTemplate'
                                ,url:  'resources/picture/upload?id=1190189815098888194'
                                ,before: function(obj){
                                    //预读本地文件示例，不支持ie8
                                    obj.preview(function(index, file, result){
                                        $('#demos1').attr('src', result); //图片链接（base64）
                                    });
                                }
                                ,done: function(res){

                                    $("[name=thumbnail]").val(res.url)
                                }
                                ,error: function(){

                                }
                            });
                        });
                    }
                })
            }
        })
    }
    function del(){
        var ids = checkChecked("templateList");
        if(ids){
            layer.confirm("此操作有风险，是否继续?",function () {
                ajax2(service_prefix.manage,"/template/delByIds","get",{ids:ids.join()}).then(res => {
                    if(!res.success){
                        layer.alert(res.msg);
                    }else{
                        doList();
                        layer.closeAll()
                    }
                })
            })

        }
    }

    var importTemplateBtn = layui.upload.render({
        elem: '#importTemplate'
        , exts: 'xls|xlsx'
        , before: function (obj) {
            layer.load();
        }, done: function (res1) {
            layer.closeAll('loading');
            if (res1.success) {
                layer.msg("上传成功");
            } else {
                layer.alert(res1.msg);
            }
        }
    });
</script>

<script>
    //========================tree
    var zTreeObj;
    function siteId(){
        return zTreeObj.getSelectedNodes()[0].id;
    }
    function siteName(){
        return zTreeObj.getSelectedNodes()[0].name;
    }
    $(function () {
        getSiteTree("siteTree",function(treeNode){
            doList();
            commonList('js');
            commonList('css');
            commonList('img');
            var url = "";
            if(treeNode){
                url = getAjaxUrl(service_prefix.manage, "/template/import/"+siteId());
            }else{
                url = "";
            }
            importTemplateBtn.reload({
                url: url
            })
        },function(to){
            zTreeObj = to;
        })
    })
</script>
<script>
    //==============================commonFile
    function addCommon(type){
        var typeUppser = type.toUpperCase();
        if(!siteId()){
            layer.msg("请选择站点!");
            return false;
        }
        layerOpenFullHtml("新建"+typeUppser,"simple/oragn/addJs.html",function(){
            $(".loadType").text(typeUppser);
            layui.form.val("jsForm",{siteid:siteId(),type:type});
            layui.form.render();
        });
    }

    function editCommon(id,type){
        var typeUppser = type.toUpperCase();
        ajaxGet("/manage/tplresource/"+id, function(data){
            layerOpenFullHtml("修改"+typeUppser,"simple/oragn/addJs.html",function(){
                $(".loadType").text(typeUppser);
                layui.form.val("jsForm",data.obj);
                layui.form.render();
            });
        })
    }

    function delCommon(type){
        var ids = checkChecked(type+"List");
        if(ids){
            layer.alert("确实要删除此"+type.toUpperCase()+"文件吗？",function(){
                ajaxJsonPost("/manage/tplresource/delete/batch", ids, function(data){
                    commonList(type);
                    layer.closeAll()
                })
            })
        }
    }

    function pubCommon(type){
        var ids = checkChecked(type+"List");
        if(ids) {
            ajaxJsonPost("/manage/tplresource/pub", ids, function (data) {
                if(data.success){
                    commonList(type);
                    layer.alert("发布成功");
                }
            })
        }
    }

    layui.upload.render({
        elem: '#importJs'
        ,url: com.jnetdata.url_prefix + "/manage/tplresource/importCommon" //此处配置你自己的上传接口即可
        ,before: function(obj){ //obj参数包含的信息，跟 choose回调完全一致，可参见上文。
            this.data={type:'js',siteId:siteId()};
        }
        ,acceptMime: 'application/x-javascript'
        ,exts: 'js'
        // ,size: 60 //限制文件大小，单位 KB
        ,done: function(res){
            layer.msg('上传成功');
            commonList('js')
        }
    });

    layui.upload.render({
        elem: '#importCss'
        ,url: com.jnetdata.url_prefix + "/manage/tplresource/importCommon" //此处配置你自己的上传接口即可
        ,acceptMime: 'text/css'
        ,exts: 'css'
        ,before: function(obj){
            this.data={type:'css',siteId:siteId()};
        }
        ,done: function(res){
            layer.msg('上传成功');
            commonList('css')
        }
    });

    layui.upload.render({
        elem: '#importImg'
        ,url: com.jnetdata.url_prefix + "/manage/tplresource/importCommon" //此处配置你自己的上传接口即可
        ,acceptMime: 'image/*'
        ,before: function(obj){
            this.data={type:'img',siteId:siteId()};
        }
        // ,size: 60 //限制文件大小，单位 KB
        ,done: function(res){
            layer.msg('上传成功');
            commonList('img')
        }
    });

    function commonList(type){
        commonList1(1,15,{type:type});
    }

    //公共JS列表
    function commonList1(pageNo,size,entity){
        if(!pageNo) pageNo = 1;
        if(!size) size = 15;
        if(!entity.siteId) entity.siteId = siteId();
        var type = entity.type;
        ajaxJsonPost("/manage/tplresource/commonList", {pager:{current:pageNo,size:size},entity:entity},function(data){
            var cols = [
                {type: 'checkbox'}
                , {type: 'numbers', title: '序号'}
                , {field: 'title', title: type.toUpperCase() + '名称',templet:'<div><span lay-event="edit" style="color:blue;text-decoration:underline;cursor:pointer;">{{d.title}}</span></div>'}
                , {field: 'path', title: '相对路径'}
                , {field: 'pubUrl', title: '发布地址',templet:'<div><span lay-event="link" style="color:blue;text-decoration:underline;cursor:pointer;">{{d.pubUrl}}</span></div>'}
            ];
            renderRightTable(type+"List",cols,data.obj.records);
            layui.table.on('tool('+type+'List)', function (obj) {
                var data = obj.data;
                if (obj.event === 'edit') {
                    if(data.type == 'img'){
                        if(data.pubUrl){
                            window.open(data.pubUrl);
                        }else{
                            layer.alert('请先发布');
                        }
                    }else{
                        editCommon(data.id,type);
                    }
                }else if (obj.event === 'link') {
                    window.open(data.pubUrl);
                }
            });
            loadPage3(type+"Page",data.obj,entity,commonList1)
        })
    }
    function exportTemplate(){
        window.open("/manage/template/export/"+siteId());
    }
</script>
<!--layui-->
<script>
    layui.form.on("submit(addTemplet)",function(data){
        data.field.siteid = siteId();
        if(data.field.id){
            ajax(service_prefix.manage,"/template/"+data.field.id,"put",JSON.stringify(data.field)).then(res => {
                doList();
                layer.closeAll();
            })
        }else{
            ajax(service_prefix.manage,"/template","post",JSON.stringify(data.field)).then(res => {
                doList();
                layer.closeAll();
            })
        }
        return false;
    })
</script>

<!--模板类型显示-->
<script type="text/html" id="typeDemo">
    {{# if(d.temptype==1){ }}
    概览
    {{#} else if(d.temptype==2){ }}
    细览
    {{#} else if(d.temptype==3){ }}
    嵌套
    {{#} else { }}
    其他
    {{# } }}
</script>
