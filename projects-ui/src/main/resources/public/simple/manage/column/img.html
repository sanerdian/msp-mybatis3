<script src="https://cdn.bootcss.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://cdn.bootcss.com/respond.js/1.4.2/respond.min.js"></script>
<script src="common/js/numberInput.js"></script>
<!--<script src="../../../js/upload.js"></script>-->
<link rel="stylesheet" href="common/css/index.css">
<link rel="stylesheet" href="common/css/column.css">
<script src="common/js/column.js"></script>
<script src="common/js/index.js"></script>
<script src="common/js/jquery.rotate.min.js"></script>
<style>
    #nav span, .right span {
        display: none;
    }

    #nav a {
        display: inline-block;
        width: 40px;
        height: 56px;
        text-align: center;
        border: 1px solid #f5f5f5;
    }

    #nav a:nth-of-type(3) {
        display: inline-block;
        width: 220px;
        height: 52px;
        text-align: left;
        padding-left: 20px;
        border-top: 2px solid #000;
        font-weight: bold;
    }

    .right {
        display: inline-block;
        position: absolute;
        top: 0;
        right: 0;
    }

    .layui-breadcrumb a {
        color: #000 !important;
    }

    #nav span,
    .right span {
        display: none;
    }

    #title li {
        width: 167px;
        border: 1px solid #ccc;
    }

    #nav a {
        display: inline-block;
        width: 40px;
        height: 56px;
        text-align: center;
        border: 1px solid #f5f5f5;
    }

    #nav a:nth-of-type(3) {
        display: inline-block;
        width: 220px;
        height: 52px;
        text-align: left;
        padding-left: 20px;
        border-top: 2px solid #000;
        font-weight: bold;
    }

    #form31 .layui-textarea {
        min-height: 45px;
    }

    .right {
        display: inline-block;
        position: absolute;
        top: 0;
        right: 0;
    }

    .layui-breadcrumb a {
        color: #000 !important;
    }

    .node_name {
        font-size: 18px;
        color: rgb(102, 102, 102);
        margin-top: -5px;
        display: inline-block;
    }

    .layui-table td {
        padding: 0;
    }

    .imgBox {
        margin-top: 20px;
        margin-left: 30px;
        height: 580px;
    }

    .imgBox li {
        width: 230px;
        height: 180px;
        background-size: 100% 100%;
        float: left;
        margin-right: 25px;
        margin-bottom: 20px;
    }

    .imgBox li .img {
        width: 230px;
        height: 150px;
        position: relative;
    }

    .imgBox li .img img {
        width: 100%;
        height: 100%;
    }

    .imgBox1 li {
        width: 100%;
        height: 115px;
        border-bottom: 1px solid #f5f5f5;
        position: relative;
    }

    .imgBox1 li .right {
        width: 140px;
        height: 70px;
        background-size: 100% 100%;
        position: absolute;
        top: 10px;
        left: 15px;
    }

    .imgBox1 li .content {
        height: 70px;
        position: absolute;
        top: 10px;
        left: 175px;
    }

    .layui-table tbody tr:hover {
        background: #fff;
    }

    td .layui-input, .layui-select, .layui-textarea {
        border: none;
    }

    .inner1 li {
        float: left;
        margin-left: 15px;
    }

    .inner1 li:last-child {
        width: 175px;
        height: 197px;
        background: #f6f6f6;
        margin-top: 10px;
        position: relative;
    }

    #test11 i {
        display: none;
    }

    #test11 .layui-colorpicker {
        width: 38px;
        height: 38px;
        padding: 0;
    }

    .inner1 li:last-child img {
        position: absolute;
        top: 40px;
        left: 30px;
    }

    #form2 .layui-form-select .layui-edge, #form3 .layui-form-select .layui-edge {
        position: absolute;
        right: 10px;
        top: 75%;
    }

    .box {
        width: 1050px;
        height: 520px;
        margin-left: 95px;
        background: #fff;
        padding: 10px 0 0 10px;
        border-radius: 2px;
    }

    .layui-layer-hui .layui-layer-content {
        padding: 0 25px;
    }

    .prev {
        width: 60px;
        height: 60px;
        border-radius: 30px;
        background: #ccc;
        position: absolute;
        line-height: 60px;
        top: 250px;
        left: 30px;
    }

    .next {
        width: 60px;
        height: 60px;
        border-radius: 30px;
        background: #ccc;
        position: absolute;
        line-height: 60px;
        top: 250px;
        right: 30px;
    }

    .image {
        width: 600px;
        height: 464px;
        /*background: url(./img/u6147.png) no-repeat;*/
        background-size: 100% 100%;
    }

    .left {
        float: left;
        margin-right: 20px;
    }

    .rights {
        /*float: left;*/
    }

    .layui-layer-hui {
        background: rgba(0, 0, 0, 0);
    }

    .node_name {
        font-size: 14px;
    }

    .videos {
        display: none;
        width: 795px;
        height: 464px;
        background: url(./img/u6147.png) no-repeat;
        background-size: 100% 100%;
        position: absolute;
        top: 0;
        left: 0
    }

    .layui-card .layui-tab {
        border: none;
        box-shadow: none;
    }
</style>


<script>
    var size = 10;
    var curr = 1;
    var url = '/picture';
    var total = 0;
    var obj = {};
    var arr = [];
    var id = "";
    var ids = ""
    var isNew = 1;
    var startTime = "";
    var endTime = "";
    /*
1.sign为0表示该资源是图片
 2.isNew为0表示是原图，isNew为1表示处理过的图片
  */
    $(function () {

        obj.sign = 0;
        getImgList(obj)
    })

    function getImgList(obj) { //获取图片列表
        var columnObj = global.zTreeObj.getSelectedNodes()[0];
        var status = Number(localStorage.getItem("isNew"));
        obj.isNew = isNew;
        obj.dataId = global.editMetadataId;
        obj.tableid = columnObj.tableId;
        var data = {
            "pager": {
                "current": curr,
                "size": 10,
                "sortProps": [
                    {
                        "key": "datetime",
                        "value": false
                    }
                ]
            },
            "picture": obj
        }
        ajax(service_prefix.resources,url + "/list", 'post', JSON.stringify(data)).then(function (res) {
            arr = res.obj.records;
            total = res.obj.total;
            layui.use('laypage', function () {
                var laypage = layui.laypage;
                //执行一个laypage实例
                laypage.render({
                    elem: 'test1'
                    , count: res.obj.total
                    , curr: res.obj.current
                    , limit: res.obj.size
                    , layout: ['count', 'prev', 'page', 'next', 'limit', 'refresh', 'skip']
                    , jump: function (obj, first) {
                        if (!first) {
                            curr = obj.curr
                            size = obj.limit
                            var obj1 = {};
                            obj1.sign = 0
                            getImgList(obj1)
                        }
                    }
                });
            });
            layui.laytpl($("#imgtpl").html()).render(res.obj.records, function (html) {
                $("#imgList").html(html);
                layui.form.render();
            })
            layui.laytpl($("#imgtpl1").html()).render(res.obj.records, function (html) {
                $("#imgList1").html(html);
                layui.form.render();
            })
        })
    }
</script>


<div class="layui-fluid">
    <div class="layui-row layui-col-space12">
        <!--<div class="layui-col-md9" style="position: relative;width: 1350px;">-->
            <div class="layui-card h100" id='list1' style="padding-top: 10px; height:800px">
                <form class="layui-form" style="display: inline-block;margin-top: 10px;">
                    <div class="layui-form-item" style="display: inline-block;">
                        <label class="layui-form-label"
                               style="padding:  9px 0px 9px 15px;width:30px;text-align:center">名称</label>
                        <div class="layui-input-block" style="width: 150px;margin-left: 65px;">
                            <input type="text" class="layui-input" placeholder="请输入" id="name">
                        </div>
                    </div>
                    <div class="layui-form-item" style="display: inline-block;">
                        <label class="layui-form-label"
                               style="padding: 9px 0 9px 15px;width:45px;text-align:center">创建者</label>
                        <div class="layui-input-block" style="width: 150px;margin-left: 65px;">
                            <input type="text" class="layui-input" placeholder="请输入" id="creator">
                        </div>
                    </div>
                    <div class="layui-form-item" style="display: inline-block;">
                        <label class="layui-form-label"
                               style="padding: 9px 0 9px 15px;width:56px;text-align:center">上传时间</label>
                        <div class="layui-input-block" style="width: 250px;margin-left: 75px;">
                            <input type="text" class="layui-input" id="t12" placeholder=" - " style="text-align: center">
                        </div>
                    </div>
                </form>
                <div class="layui-btn-container"
                     style="display: inline-block;width: 540px;margin-left: 10px;">
                    <button class="layui-btn" type="button" onclick="search()"><i class="layui-icon layui-icon-search"></i></button>
                    <button class="layui-btn" type="button" onclick="delByIds()">批量删除</button>
                    <button class="layui-btn" type="button" onclick="addMark()">批量新建水印</button>
                    <button class="layui-btn" type="button" onclick="createCodes()">资源发布</button>
                    <button class="layui-btn" type="button" onclick="uploadImg()" id="uploads">图片上传</button>
                </div>
                <div class="layui-form">
                    <table class="layui-table">
                        <colgroup>
                            <col width="80">
                            <col width="100">
                            <col width="100">
                            <col width="100">
                            <col width="120">
                            <col width="30" align="center">
                            <col width="30" align="center">
                        </colgroup>
                        <tbody>
                        <tr>
                            <td>
                                <div class="layui-input-block" style="margin-left: 0;">
                                    <select name="" id="sort" lay-filter="sort">
                                        <option value="默认排序" selected>默认排序</option>
                                        <option value="上传时间排序">上传时间排序</option>
                                        <option value="上传时间排序">文件大小排序</option>
                                    </select>
                                </div>
                            </td>
                            <td>
                                <div class="layui-input-block" style="margin-left: 0;">
                                    <select name="form" id="" lay-verify="required" lay-filter="style">
                                        <option value="" disabled selected hidden>版式</option>
                                        <option value="全部">全部</option>
                                        <option value="横图">横图</option>
                                        <option value="竖图">竖图</option>
                                    </select>
                                </div>
                            </td>
                            <td>
                                <div class="layui-input-block" style="margin-left: 0;">
                                    <select id="" lay-verify="required" lay-filter="forms">
                                        <option value="" disabled selected hidden>格式</option>
                                        <option value="全部">全部</option>
                                        <option value="jpg">jpg</option>
                                        <option value="png">png</option>
                                        <option value="tif">tif</option>
                                        <option value="gif">gif</option>
                                        <option value="bmp">bmp</option>
                                    </select>
                                </div>
                            </td>
                            <td>
                                <div class="layui-input-block" style="margin-left: 0;">
                                    <select name="form" id="" lay-verify="required" lay-filter="copyright">
                                        <option value="" disabled selected hidden>版权归属</option>
                                        <option value="全部">全部</option>
                                        <option value="原创">原创</option>
                                        <option value="经授权">经授权</option>
                                        <option value="其他">其他</option>
                                    </select>
                                </div>
                            </td>
                            <td>
                                <div class="layui-input-block" style="margin-left: 0;">
                                    <select name="form" id="" lay-verify="required" lay-filter="state">
                                        <option value="" disabled selected hidden>图片状态</option>
                                        <option value="0">新稿</option>
                                        <option value="10">审核</option>
                                        <option value="20">发布</option>
                                    </select>
                                </div>
                            </td>
                            <td class="img1">
                                <img src="./img/u6616_mouseOver.png" alt="" srcset="" style="margin-left: 10px;" id='change1'>
                            </td>
                            <td class="img1">
                                <img src="./img/u6611.png" alt="" srcset="" style="margin-left: 10px;" id='change2'>
                            </td>
                        </tr>

                        </tbody>
                    </table>
                    <ul class="imgBox" id="imgList" style="height:600px;overflow: auto">
                    </ul>

                    <ul class="imgBox1" id="imgList1" style="display: none;height:600px;overflow: auto">

                    </ul>

                    <div id="test1" style="margin: 10px 0 0 30px;"></div>
                </div>
            </div>
            <div class="layui-card h100" id='list2' style="display: none;height: 800px">
                <div class="layui-card-header"><p style="color: #0000ff;cursor: pointer;" onclick='returnBack()'>返回上一级</p></div>
                <div class="layui-card-body">
                    <div class='inner' style="width: 695px;height:234px;margin: 180px auto">
                        <form class="layui-form" method="post" action="javascript:;">

                            <div class="layui-form-item">

                                <div class="layui-inline">
                                    <div class="layui-upload-drag " id="chooseFile">
                                        <p style="width: 265px;position: relative;margin-left: 145px"><i class="layui-icon layui-icon-upload" style="font-size: 35px"></i>&nbsp;&nbsp;&nbsp;<span
                                                style="position: absolute">点击上传</span></p>
                                        <p style="margin-top:20px; color:#ccc;text-align: center;">
                                            --------------------------------------&nbsp;&nbsp;或&nbsp;&nbsp;--------------------------------------</p>
                                        <p style="margin-top:20px; color:#0000ff;text-align: center;font-size: 20px;">从电脑里拖拽图片至此上传</p>
                                        <p style="margin-top:20px; color:#ccc;text-align: center;color:#ccc;">支持jpg、png、jpeg、gif...等格式,图像大于72dpi,宽度大于2000px;（批量上传每次上限300个）</p>
                                    </div>
                                </div>

                            </div>

                        </form>

                    </div>
                </div>

            </div>
            <div class="layui-card h100" id='list3' style="display: none;height: 800px">
                <div class="layui-card-header"><p style="color: #0000ff;cursor: pointer;" onclick='returnBack1()'>返回上一级</p></div>
                <div class="layui-card-body" style="height: 650px">

                    <div class="inner1">
                        <div class="layui-main">
                            <div class="layui-inline" id="upload_preview"></div>
                        </div>
                        <form class="layui-form" style="margin-top: 480px">
                            <div class="layui-form-item">
                                <div class="layui-input-block" style="margin-left: 0">
                                    <input type="checkbox" lay-filter="check" lay-skin="primary" title="按默认设置处理（水印、压缩…）">
                                </div>
                            </div>
                        </form>
                        <div class="edit" style="position: relative;">
                            <button class="layui-btn layui-btn-normal layui-btn-lg" style="width: 265px;margin-bottom: 10px;display: inline-block;" onclick="edit()"><i
                                    class="layui-icon layui-icon-upload"></i>编辑图片
                            </button>
                            <span style="margin-left: 15px;color:#666;display: inline-block;height: 44px;position: absolute;top:10px;line-height: 44px;">共<i id="counts">0</i>张照片（上传过程中请不要删除原始照片）</span>
                        </div>
                    </div>
                </div>
            </div>
            <div class="layui-card h100" id='list5' style="display: none;height: 800px">
                <div class="layui-card-header"><p style="color: #0000ff;cursor: pointer;" onclick='returnBack3()'>返回上一级</p></div>
                <div class="layui-card-body">
                    <div class="inner3">
                        <h3 style="color: #169BD5;margin-left: 500px;margin-top:20px;font-weight:bold;display: inline-block;">单独新建信息</h3>
                        <div class="infoBox" style="width: 470px;height:100%;border-left:1px solid #ccc;float:right;margin-top: 20px;">
                            <div class="layui-tab layui-tab-brief" lay-filter="docDemoTabBrief">

                                <div class="layui-tab-content">
                                    <div class="layui-tab-item layui-show">
                                        <form class="layui-form" id='form31' lay-filter="info" style="height: 614px">
                                            <button class="layui-btn layui-btn-normal" style="width: 310px;margin:0px 0 20px 50px;" onclick="confirm1()" type="button">保存</button>
                                            <div class="layui-form-item">
                                                <label class="layui-form-label">图片名称</label>
                                                <div class="layui-input-block">
                                                    <input type="text" class="layui-input" placeholder="请输入内容" name="name" id="picName">
                                                </div>
                                            </div>
                                            <div class="layui-form-item">
                                                <label class="layui-form-label">*版权归属</label>
                                                <div class="layui-input-block">
                                                    <select name="copyright" id="belong">
                                                        <option value="原创">原创</option>
                                                        <option value="经授权">经授权</option>
                                                        <option value="其他">其他</option>
                                                    </select>
                                                </div>
                                            </div>
                                            <div class="layui-form-item">
                                                <label class="layui-form-label">来源</label>
                                                <div class="layui-input-block">
                                                    <input type="text" class="layui-input" placeholder="请输入内容" name="resc" id="resource">
                                                </div>
                                            </div>
                                            <div class="layui-form-item">
                                                <label class="layui-form-label">*描述</label>
                                                <div class="layui-input-block">
                                                    <textarea class="layui-textarea" style="border: 1px solid #ccc" name="desc" id="ms"></textarea>
                                                </div>
                                            </div>
                                            <div class="layui-form-item">
                                                <label class="layui-form-label">文件夹路径</label>
                                                <div class="layui-input-block">
                                                    <input type="text" class="layui-input" placeholder="请输入内容" name="path" id="paths">
                                                </div>
                                            </div>
                                            <div class="layui-form-item">
                                                <label class="layui-form-label">格式</label>
                                                <div class="layui-input-block">
                                                    <select name="form" id="forms">
                                                        <option value="jpg" selected>jpg</option>
                                                        <option value="png">png</option>
                                                        <option value="gif">gif</option>
                                                    </select>
                                                </div>
                                            </div>
                                            <div class="layui-form-item">
                                                <label class="layui-form-label">文件大小</label>
                                                <div class="layui-input-block">
                                                    <input type="text" class="layui-input" value="" name="size" id="size">
                                                </div>
                                            </div>
                                            <div class="layui-form-item">
                                                <label class="layui-form-label">比例</label>
                                                <div class="layui-input-block">
                                                    <input type="text" class="layui-input" value="" name="scale" id="scale">
                                                </div>
                                            </div>
                                            <div class="layui-form-item">
                                                <label class="layui-form-label">分辨率</label>
                                                <div class="layui-input-block">
                                                    <input type="text" class="layui-input" value="" name="reso" id="reso">
                                                </div>
                                            </div>
                                            <div class="layui-form-item">
                                                <label class="layui-form-label">版式</label>
                                                <div class="layui-input-block">
                                                    <select name="style" id="style">
                                                        <option value="横版" selected>横版</option>
                                                        <option value="竖版">竖版</option>
                                                    </select>
                                                </div>
                                            </div>
                                        </form>
                                    </div>
                                    <div class="layui-tab-item" id="content">
                                        <form class="layui-form" style="height: 614px" lay-filter="detailInfo">
                                            <button class="layui-btn layui-btn-normal" style="width: 310px;margin:0px 0 20px 50px;" onclick="confirm1()" type="button">保存</button>
                                            <div class="layui-form-item">
                                                <label class="layui-form-label">色域、色彩空间</label>
                                                <div class="layui-input-block">
                                                    <input type="text" class="layui-input" name="Color Space" disabled>
                                                </div>
                                            </div>
                                            <div class="layui-form-item">
                                                <label class="layui-form-label">图像构造</label>
                                                <div class="layui-input-block">
                                                    <input type="text" class="layui-input" name="Components Configuration" disabled>
                                                </div>
                                            </div>
                                            <div class="layui-form-item">
                                                <label class="layui-form-label">镜头光圈</label>
                                                <div class="layui-input-block">
                                                    <input type="text" class="layui-input" name="Aperture Value" disabled>
                                                </div>
                                            </div>
                                            <div class="layui-form-item">
                                                <label class="layui-form-label">曝光补偿</label>
                                                <div class="layui-input-block">
                                                    <input type="text" class="layui-input" name="Exposure Bias Value" disabled>
                                                </div>
                                            </div>
                                            <div class="layui-form-item">
                                                <label class="layui-form-label">测光方式</label>
                                                <div class="layui-input-block">
                                                    <input type="text" class="layui-input" name="Metering Mode" disabled>
                                                </div>
                                            </div>
                                            <div class="layui-form-item">
                                                <label class="layui-form-label">焦距</label>
                                                <div class="layui-input-block">
                                                    <input type="text" class="layui-input" name="Focal Length" disabled>
                                                </div>
                                            </div>
                                            <div class="layui-form-item">
                                                <label class="layui-form-label">光圈值</label>
                                                <div class="layui-input-block">
                                                    <input type="text" class="layui-input" name="F-Number" disabled>
                                                </div>
                                            </div>
                                            <div class="layui-form-item">
                                                <label class="layui-form-label">曝光程序</label>
                                                <div class="layui-input-block">
                                                    <input type="text" class="layui-input" name="Exposure Program" disabled>
                                                </div>
                                            </div>
                                            <div class="layui-form-item">
                                                <label class="layui-form-label">曝光方式</label>
                                                <div class="layui-input-block">
                                                    <input type="text" class="layui-input" name="Exposure Mode" disabled>
                                                </div>
                                            </div>
                                            <div class="layui-form-item">
                                                <label class="layui-form-label">曝光时间</label>
                                                <div class="layui-input-block">
                                                    <input type="text" class="layui-input" name="Exposure Time" disabled>
                                                </div>
                                            </div>
                                        </form>
                                    </div>
                                </div>
                                <ul class="layui-tab-title">
                                    <li class="layui-this">基本信息</li>
                                    <li id="head" style="display:none ">详细信息</li>
                                </ul>
                            </div>


                        </div>
                        <div class="imgIcon" style="width:379px;height:466px;margin: 50px 0 0 150px;position: relative;">
                            <!-- <img src="./img/u6733.jpg" alt="" srcset="" style="width: 100%;height:100%;"> -->
                            <!--<img src="./img/u7603.png" alt="" srcset="" style="position: absolute;width: 60px;height: 60px;;position: absolute;top:50%;left:50%;margin: -30px 0 0 -30px;">-->
                            <ul class="picView-magnify-list" style="padding: 30px" id="list">
                                <li style="width: 100%;height: 100%">
                                    <a href="javascript:void(0)" data-magnify="gallery" data-group="g1" data-src="./img/u6147.png" data-caption="测试图片一">
                                        <img src="" alt="" id="img" style="width: 100%;height: 100%">
                                    </a>
                                </li>
                            </ul>

                        </div>
                    </div>
                </div>
            </div>
            <div class="layui-card h100" id='list7' style="display: none;height: 800px">
                <div class="layui-card-header"><p style="color: #0000ff;cursor: pointer;" onclick='returnBack5()'>返回上一级</p></div>
                <div class="layui-card-body" id="editInfo">

                </div>
            </div>
        <!--</div>-->
    </div>
</div>

<script type="text/html" id="imgtpl">
    {{# layui.each(d, function(index, item){ }}
    <li>
        <div class="img">
            <img src="{{ item.url}}" alt="" onclick="preview('{{item.id}}',event)">
            <div class="checkDiv" style="position: absolute;top:0px;left:5px">
                <input type="checkbox" name="ids" lay-skin="primary" id="check" lay-filter="checked" value="{{item.id}}">
            </div>

            <!--<div class="layui-btn-container" style="position: absolute;right:0px;top:0px;" id="collect">-->
            <!--<button class="layui-btn layui-btn-sm"-->
            <!--style="background: rgba(0,0,0,0.7);border-radius: 2px;" >-->
            <!--{{#if(item.collection===0){ }}-->
            <!--<img src="img/u582.png" alt="" onclick="collect('{{item.id}}',event)" style="    width: 25px;-->
            <!--height: 25px;-->
            <!--margin-top: 3px;" >-->
            <!--{{#} else if(item.collection===1){ }}-->
            <!--<img src="img/u582_mouseOver.png" alt="" onclick="collect('{{item.id}}',event)" style="    width: 25px;-->
            <!--height: 25px;-->
            <!--margin-top: 3px;" >-->
            <!--{{#} }}-->
            <!--</button>-->
            <!--<button class="layui-btn layui-btn-sm"-->
            <!--<button class="layui-btn layui-btn-sm"-->
            <!--style="background: rgba(0,0,0,0.7);border-radius: 2px" onclick="downLoadPic('{{item.id}}',event)">下载</button>-->
            <!--<button class="layui-btn layui-btn-sm"-->
            <!--style="background: rgba(0,0,0,0.7);border-radius: 2px" onclick="deletes('{{item.id}}',event)"><i-->
            <!--class="layui-icon layui-icon-delete"></i></button>-->
            <!--</div>-->
        </div>
        <div class="text" style="margin-top:10px;height: 20px;width: 240px;overflow: hidden;
text-overflow:ellipsis;white-space: nowrap;">

            {{#if(item.status===0){ }}
            <span style="color: blue">新稿</span>
            {{#} else if(item.status===10){ }}
            <span style="color: blue">审核</span>
            {{#} else if(item.status===20){ }}
            <span style="color: blue">发布</span>
            {{#} }}
            |&nbsp;&nbsp;<span style="text-align: center" title="{{item.name}}.{{item.form}}">{{item.name}}.{{item.form}}</span>
        </div>
    </li>
    {{#  }); }}
    {{# if(d.length === 0){ }}
    无数据
    {{# } }}
</script>
<script type="text/html" id="imgtpl1">
    {{# layui.each(d, function(index, item){ }}
    <li>
        <div class="right">
            <img src="{{'/files' + item.path.substring(12)}}" alt="" style="width: 100%;height: 100%">
        </div>
        <div class="content">
            <p> {{item.name}}</p>
            <p style="margin-top: 15px;">
                <span>来源：{{item.resc}}</span>
                <span>格式：{{item.form}}</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span>大小：{{item.size}}kB</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span>上传时间：{{item.createTime}}</span>
            </p>
            <p style="margin-top: 5px;">
                <span>路径：{{item.url}}</span>
            </p>

        </div>
        <div class="layui-btn-container" style="position: absolute;right:20px;top:30px;">
            <!--<div class="layui-btn" onclick="downLoadPic('{{item.id}}',event)">下载</div>-->
            <!--<div class="layui-btn layui-btn-danger" onclick="deletes('{{item.id}}',event)">删除</div>-->
        </div>
    </li>
    {{#  }); }}
    {{# if(d.length === 0){ }}
    无数据
    {{# } }}
</script>

<script type="text/html" id="inner">
    <div class="inner5">
        <div class='left' style="width: 700px;height:500px;background: #f5f5f5;padding: 20px;margin-top: 40px;display: inline-block">
            <img src="/picture/downLoad?id={{d.id}}" class='image' style="height: 484px;width: 695px;position: relative;">
        </div>
        <div class="infoBox" style="width: 420px;height:610px;border-left:1px solid #ccc;overflow: auto;position: absolute;top:40px;right:0;">
            <div class="layui-tab layui-tab-brief" lay-filter="docDemoTabBrief">

                <div class="layui-tab-content">
                    <div class="layui-tab-item layui-show">
                        <form class="layui-form" id='form31' lay-filter="info" style="height: 614px">
                            <button class="layui-btn layui-btn-normal" style="width: 310px;margin:0px 0 20px 50px;" lay-submit lay-filter="confirm" type="button">保存</button>
                            <div class="layui-form-item">
                                <label class="layui-form-label">图片名称</label>
                                <div class="layui-input-block">
                                    <input type="text" class="layui-input" placeholder="请输入内容" name="name" id="picName">
                                </div>
                            </div>
                            <div class="layui-form-item">
                                <label class="layui-form-label">*版权归属</label>
                                <div class="layui-input-block">
                                    <select name="copyright" id="belong">
                                        <option value="原创">原创</option>
                                        <option value="经授权">经授权</option>
                                        <option value="其他">其他</option>
                                    </select>
                                </div>
                            </div>
                            <div class="layui-form-item">
                                <label class="layui-form-label">来源</label>
                                <div class="layui-input-block">
                                    <input type="text" class="layui-input" placeholder="请输入内容" name="resc" id="resource">
                                </div>
                            </div>
                            <div class="layui-form-item">
                                <label class="layui-form-label">*描述</label>
                                <div class="layui-input-block">
                                    <textarea class="layui-textarea" style="border: 1px solid #ccc" name="desc" id="ms"></textarea>
                                </div>
                            </div>
                            <div class="layui-form-item">
                                <label class="layui-form-label">文件夹路径</label>
                                <div class="layui-input-block">
                                    <input type="text" class="layui-input" placeholder="请输入内容" name="path" id="paths">
                                </div>
                            </div>
                            <div class="layui-form-item">
                                <label class="layui-form-label">格式</label>
                                <div class="layui-input-block">
                                    <select name="form" id="forms">
                                        <option value="jpg" selected>jpg</option>
                                        <option value="png">png</option>
                                        <option value="gif">gif</option>
                                    </select>
                                </div>
                            </div>
                            <div class="layui-form-item">
                                <label class="layui-form-label">文件大小</label>
                                <div class="layui-input-block">
                                    <input type="text" class="layui-input" value="" name="size" id="size">
                                </div>
                            </div>
                            <div class="layui-form-item">
                                <label class="layui-form-label">比例</label>
                                <div class="layui-input-block">
                                    <input type="text" class="layui-input" value="" name="scale" id="scale">
                                </div>
                            </div>
                            <div class="layui-form-item">
                                <label class="layui-form-label">分辨率</label>
                                <div class="layui-input-block">
                                    <input type="text" class="layui-input" value="" name="reso" id="reso">
                                </div>
                            </div>
                            <div class="layui-form-item">
                                <label class="layui-form-label">版式</label>
                                <div class="layui-input-block">
                                    <select name="style" id="style">
                                        <option value="横版" selected>横版</option>
                                        <option value="竖版">竖版</option>
                                    </select>
                                </div>
                            </div>
                        </form>
                    </div>
                    <div class="layui-tab-item" id="contents">
                        <form class="layui-form" style="height: 614px" lay-filter="detailInfo">
                            <button class="layui-btn layui-btn-normal" style="width: 310px;margin:0px 0 20px 50px;" onclick="confirm1()" type="button">保存</button>
                            <div class="layui-form-item">
                                <label class="layui-form-label">色域、色彩空间</label>
                                <div class="layui-input-block">
                                    <input type="text" class="layui-input" name="Color Space" disabled>
                                </div>
                            </div>
                            <div class="layui-form-item">
                                <label class="layui-form-label">图像构造</label>
                                <div class="layui-input-block">
                                    <input type="text" class="layui-input" name="Components Configuration" disabled>
                                </div>
                            </div>
                            <div class="layui-form-item">
                                <label class="layui-form-label">镜头光圈</label>
                                <div class="layui-input-block">
                                    <input type="text" class="layui-input" name="Aperture Value" disabled>
                                </div>
                            </div>
                            <div class="layui-form-item">
                                <label class="layui-form-label">曝光补偿</label>
                                <div class="layui-input-block">
                                    <input type="text" class="layui-input" name="Exposure Bias Value" disabled>
                                </div>
                            </div>
                            <div class="layui-form-item">
                                <label class="layui-form-label">测光方式</label>
                                <div class="layui-input-block">
                                    <input type="text" class="layui-input" name="Metering Mode" disabled>
                                </div>
                            </div>
                            <div class="layui-form-item">
                                <label class="layui-form-label">焦距</label>
                                <div class="layui-input-block">
                                    <input type="text" class="layui-input" name="Focal Length" disabled>
                                </div>
                            </div>
                            <div class="layui-form-item">
                                <label class="layui-form-label">光圈值</label>
                                <div class="layui-input-block">
                                    <input type="text" class="layui-input" name="F-Number" disabled>
                                </div>
                            </div>
                            <div class="layui-form-item">
                                <label class="layui-form-label">曝光程序</label>
                                <div class="layui-input-block">
                                    <input type="text" class="layui-input" name="Exposure Program" disabled>
                                </div>
                            </div>
                            <div class="layui-form-item">
                                <label class="layui-form-label">曝光方式</label>
                                <div class="layui-input-block">
                                    <input type="text" class="layui-input" name="Exposure Mode" disabled>
                                </div>
                            </div>
                            <div class="layui-form-item">
                                <label class="layui-form-label">曝光时间</label>
                                <div class="layui-input-block">
                                    <input type="text" class="layui-input" name="Exposure Time" disabled>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>
                <ul class="layui-tab-title">
                    <li class="layui-this">基本信息</li>
                    <li id="heads" style="display:none ">详细信息</li>
                </ul>
            </div>

        </div>
    </div>
</script>

<script>
    function createCodes() { //生成前端代码
        var data = document.getElementsByName("ids")
        var ids = "";
        var count = 0;
        for (var i in data) {
            if (data[i].checked) {
                if (count !== 0) {
                    ids += ",";
                }
                ids += data[i].value;
                count++;
            }
        }
        if (ids === "") {
            layer.alert("请选择需要发布的图片")
            return false;
        }
        var id = localStorage.getItem("picId");
        if (id && id === ids) {
            layer.alert("该图片已发布过，请重新选择其他图片发布");
            return false
        }
        changeState("发布", ids)
    }

    function collect(id, event) {
        var src = event.target.getAttribute('src')
        if (src === "img/u582.png") {
            event.target.setAttribute('src', "img/u582_mouseOver.png")
            ajax(url + "/changeCollect?id=" + id, 'post').then(function (res) {
            })
        } else if (src === "img/u582_mouseOver.png") {
            event.target.setAttribute('src', "img/u582.png")
            ajax(url + "/changeCollect?id=" + id, 'post').then(function (res) {
            })
        }
    }

    function selected(event) {
        event.stopPropagation()
    }

    layui.use('laydate', function () {  //日期显示组件
        var laydate = layui.laydate;
        laydate.render({
            elem: '#t12'
            , range: true
            , done: function (value) {
                startTime = value.split(' -')[0]
                endTime = value.split('- ')[1]
            }
        });

    })
    var zNodes;
    var flag = false;
    var bool = false;

    function addMark() { //批量新建水印
        var data = document.getElementsByName("ids")
        var ids = "";
        var count = 0;
        for (var i in data) {
            if (data[i].checked) {
                if (count !== 0) {
                    ids += ",";
                }
                ids += data[i].value;
                count++;

            }

        }
        if (ids === "") {
            layer.alert("请选择需要加水印的图片")
            return false;
        }
        var markId = localStorage.getItem("markId");
        var syType = localStorage.getItem('syType');
        var idArr = ids.split(',')
        if (syType === "文字水印") {
            ajax(url + "/addWaterMark?ids=" + ids + "&markid=" + markId, 'post').then(function (res) {
                if (res.success) {
                    var obj = {};
                    obj.sign = 0;
                    getImgList(obj)
                }
            })
        } else {
            ajax("/picture/addPictWaterMark?ids=" + ids + "&markid=" + markId, 'post').then(function (res) {
                if (res.success) {
                    var obj = {};
                    obj.sign = 0;
                    getImgList(obj)
                }
            })
        }

    }

    function delByIds() { //判断是否勾选要删除的图片
        var data = document.getElementsByName("ids")
        var ids = "";
        var count = 0;
        for (var i in data) {
            if (data[i].checked) {
                if (count !== 0) {
                    ids += ",";
                }
                ids += data[i].value;
                count++;
            }
        }
        if (ids === "") {
            layer.alert("请选择要删除的图片")
            return false;
        }
        deletePics(ids)
    }

    function deletePics(ids) {  //批量删除图片
        ajax("/picture/delByIds?ids=" + ids, 'get').then(function (res) {
            if (res.success) {
                var status = Number(localStorage.getItem("isNew"));
                if (status) {
                    obj.isNew = status;
                } else {
                    obj.isNew = isNew;
                }

                var data = {
                    "pager": {
                        "current": 1,
                        "size": 10
                    },
                    "picture": obj
                }
                ajax(url + "/list", 'post', JSON.stringify(data)).then(function (res) {
                    arr = res.obj.records;
                    total = res.obj.total;
                    layui.use('laypage', function () {
                        var laypage = layui.laypage;

                        //执行一个laypage实例
                        laypage.render({
                            elem: 'test1'
                            , count: res.obj.total
                            , curr: res.obj.current
                            , limit: 5
                            , layout: ['count', 'prev', 'page', 'next', 'limit', 'refresh', 'skip']
                            , jump: function (obj, first) {
                                if (!first) {
                                    curr = obj.curr
                                    size = obj.limit
                                    var obj1 = {};
                                    obj1.sign = 0
                                    getImgList(obj1)
                                }
                            }
                        });
                    });
                    layui.laytpl($("#imgtpl").html()).render(res.obj.records, function (html) {
                        $("#imgList").html(html);
                        layui.form.render();
                    })
                    layui.laytpl($("#imgtpl1").html()).render(res.obj.records, function (html) {
                        $("#imgList1").html(html);
                        layui.form.render();
                    })
                })
            }
        })
    }

    //获取所有子节点
    function getAllChildrenNodes(treeNode, result) {
        if (treeNode.isParent) {
            var childrenNodes = treeNode.children;
            if (childrenNodes) {
                for (var i = 0; i < childrenNodes.length; i++) {
                    result += ',' + childrenNodes[i].id;
                    result = getAllChildrenNodes(childrenNodes[i], result);
                }
            }
        }
        return result;
    }


    //对图片的格式进行筛选
    function selectform(form) {
        var obj = {};
        obj.sign = 0;
        var data = {
            "pager": {
                "current": curr,
                "size": size
            },
            "picture": obj
        }
        ajax(url + "/list", 'post', JSON.stringify(data)).then(function (res) {
            res.obj.records = res.obj.records.filter(function (item) {
                return item.form == form;
            })
            total = res.obj.records.length;
            layui.use('laypage', function () {
                var laypage = layui.laypage;

                //执行一个laypage实例
                laypage.render({
                    elem: 'test1'
                    , count: res.obj.total
                    , curr: res.obj.current
                    , limit: res.obj.size
                    , layout: ['count', 'prev', 'page', 'next', 'limit', 'refresh', 'skip']
                    , jump: function (obj, first) {
                        if (!first) {
                            curr = obj.curr
                            size = obj.limit
                            var obj1 = {};
                            obj1.sign = 0
                            getImgList(obj1)
                        }
                    }
                });
            });
            layui.laytpl($("#imgtpl").html()).render(res.obj.records, function (html) {
                $("#imgList").html(html);
                layui.form.render();
            })
        })
    }

    var form = layui.form;
    var forms = "";
    var copyright = "";
    var style = ""
    var status;
    form.on('select(state)', function (data) {
        status = data.value
        var obj = {};
        obj.sign = 0;
        obj.status = status;
        getImgList(obj)
    })
    //默认排序
    form.on('select(sort)', function (data) {
        switch (data.value) {
            case  "默认排序":
                var obj = {};
                obj.sign = 0;
                getImgList(obj);
                break;
            case "上传时间排序":
                var obj = {};
                obj.sign = 0;
                var data = {
                    "pager": {
                        "current": curr,
                        "size": size
                    },
                    "picture": obj
                }
                ajax(url + "/list", 'post', JSON.stringify(data)).then(function (res) {
                    res.obj.records.forEach(function (item) {
                        item.createTime = new Date(item.createTime).getTime()
                    })
                    res.obj.records.sort(function (a, b) {
                        return b.createTime - a.createTime;
                    })
                    total = res.obj.total;
                    layui.use('laypage', function () {
                        var laypage = layui.laypage;

                        //执行一个laypage实例
                        laypage.render({
                            elem: 'test1'
                            , count: total
                            , layout: ['count', 'prev', 'page', 'next', 'limit', 'refresh', 'skip']
                        });
                    });
                    layui.laytpl($("#imgtpl").html()).render(res.obj.records, function (html) {
                        $("#imgList").html(html);
                        layui.form.render();
                    })
                })
                break;
            case "文件大小排序":
                var obj = {};
                obj.sign = 0;
                var data = {
                    "pager": {
                        "current": curr,
                        "size": size
                    },
                    "picture": obj
                }
                ajax(url + "/list", 'post', JSON.stringify(data)).then(function (res) {
                    res.obj.records.sort(function (a, b) {
                        return b.size - a.size;
                    })
                    total = res.obj.total;
                    layui.use('laypage', function () {
                        var laypage = layui.laypage;

                        //执行一个laypage实例
                        laypage.render({
                            elem: 'test1'
                            , count: total
                            , layout: ['count', 'prev', 'page', 'next', 'limit', 'refresh', 'skip']
                        });
                    });
                    layui.laytpl($("#imgtpl").html()).render(res.obj.records, function (html) {
                        $("#imgList").html(html);
                        layui.form.render();
                    })
                })

        }
    });
    //根据版式筛选
    form.on("select(style)", function (data) {
        style = data.value;
        switch (data.value) {
            case "全部":
                var obj = {};
                obj.sign = 0;
                getImgList(obj);
                break;

        }
    })
    //根据格式筛选
    form.on("select(forms)", function (data) {
        forms = data.value;
        switch (data.value) {
            case "全部":
                var obj = {};
                obj.sign = 0;
                getImgList(obj);
                break;

        }
    })
    //根据版权筛选
    form.on("select(copyright)", function (data) {
        copyright = data.value
        switch (data.value) {
            case "全部":
                var obj = {};
                obj.sign = 0;
                getImgList(obj);
                break;


        }
    })
    form.on("select", function (data) {
        if (forms === "全部") {
            forms = "";
        }
        if (style === "全部") {
            style = "";
        }
        if (copyright === "全部") {
            copyright = "";
        }
        var obj = {};
        obj.sign = 0;
        obj.form = forms;
        obj.style = style;
        if (status) {
            obj.status = Number(status);
        }
        obj.copyright = copyright
        getImgList(obj);
    })
</script>
<script>

    var idArr = [];

    //预览图片
    function preview(id, event) {
        event.stopPropagation();
        layer.msg("<div id='form9'></div>", {
            time: 0,
            closeBtn: 2,
            shade: 0.3,
            area: ['1300px', '530px']
        });
        ajax(url + "/" + id, "get").then(function (res) {

            layui.laytpl($("#detail").html()).render(res.obj, function (html) {
                $("#form9").html(html);
                if (res.obj.isNew === 0) {
                    $("#lookOld").hide();
                    $("#downloadOld").hide()
                } else {
                    $("#lookOld").show();
                    $("#downloadOld").show()
                }
                layui.form.render();

            })
        })

    }
    //图片上传

    //上传图片弹框
    function uploadFile() {
        layer.open({
            type: 1 //此处以iframe举例
            , title: '上传'
            , area: ['800px', '600px']
            , shade: 0.3
            , maxmin: true
            , content: "<div id='form9'></div>"

        });
        layui.laytpl($("#uploadTpl").html()).render({}, function (html) {
            $("#form9").html(html);
            layui.form.render();
        })
    }

    //是否勾选按默认设置处理
    form.on('checkbox(check)', function (data) {
        var checked = data.elem.checked;
        var syType = localStorage.getItem('syType');
        var markId = localStorage.getItem("markId")
        if (checked) {
            if (syType === "文字水印") {
                var ids = "";
                if (idArr.length === 1) {
                    ids = idArr[0]
                } else {
                    ids = idArr.join(',');
                }
                isNew = "";
                localStorage.setItem("isNew", isNew)
                ajax(url + "/addWaterMark?ids=" + ids + "&markid=" + markId, 'post').then(function (res) {
                })
//             //压缩图片
                var width = Number(localStorage.getItem("width"));
                var height = Number(localStorage.getItem("height"));
                ajax(url + "/picCompress?ids=" + ids + "&w=" + width + "&h=" + height, "post").then(function (res) {
                })
            } else {
                var ids = "";
                if (idArr.length === 1) {
                    ids = idArr[0]
                } else {
                    ids = idArr.join(',');
                }
                isNew = "1";
                localStorage.setItem("isNew", isNew);
                var location = Number(localStorage.getItem("location"))
                var alpha = Number(localStorage.getItem("alpha"))
                ajax("/picture/addPictWaterMark?ids=" + ids + "&markid=" + markId, 'post').then(function (res) {
                })
                var width = Number(localStorage.getItem("width"));
                var height = Number(localStorage.getItem("height"));
                ajax(url + "/picCompress?ids=" + ids + "&w=" + width + "&h=" + height, "post").then(function (res) {
                })
            }
        } else {
            isNew = "0";
            localStorage.setItem("isNew", isNew)
        }
    })
    var forms1 = "", limitForm = "", size = "", limitSize = "";

    function edit() { //编辑图片
        ajax("/picture/" + idArr[0], "get").then(function (res) {
            if (res.success) {
                $('#list3').hide();
                forms1 = res.obj.form;
                size = res.obj.size;
                $('#list5').show();
                $(".magnify-modal").show();
                $("#img").attr("src", res.obj.url)
                var picInfo = localStorage.getItem('picInfo');
                if (picInfo === "是") {
                    $("#head").show()
                } else {
                    $("#head").hide()
                }
                layui.form.val("info", res.obj)
            }
        })
        ajax("/picture/getPicInfo?ids=" + idArr[0], 'post').then(function (res) {
            if (res.success) {
                layui.form.val("detailInfo", res.obj[0])
            }
        })
    }

    function returnBack() {//回到上一级
        $("#list1").show();
        $('#list2').hide();
    }

    function returnBack1() {
        $("#list2").show();
        $('#list3').hide();
    }

    function returnBack2() {
        $("#list3").show();
        $('#list4').hide();
    }

    function returnBack3() {
        $("#list3").show();
        $('#list5').hide();
        $(".magnify-modal").hide();
    }

    function returnBack4() {
        $("#list1").show();
        $('#list6').hide();
    }

    function returnBack5() {
        $("#list1").show();
        $('#list7').hide();
    }

    $("#change2").hover(function () {
        $(this).attr('src', './img/u6611_mouseOver.png');
    }, function () {
        $(this).attr('src', './img/u6611.png');
    })


    $('.img1').click(function () {
        if ($(this).find('img').attr('id') == 'change2') {
            $(this).find('img').attr('src', './img/u6611_mouseOver.png');
            $('#change1').attr('src', './img/u6616.png')
            $(".imgBox").hide()
            $(".imgBox1").show()
        } else if ($(this).find('img').attr('id') == 'change1') {
            $(this).find('img').attr('src', './img/u6616_mouseOver.png');
            $('#change2').attr('src', './img/u6611.png')
            $(".imgBox").show()
            $(".imgBox1").hide()
        }
    })


    layui.use('form', function () { //声明使用layUI的form
        var form = layui.form;
        form.render(); //刷新所有渲染效果，也可以单独熟悉某个效果
        //监听提交
        form.on('submit(formDemo)', function (data) {
            layer.msg(JSON.stringify(data.field));
            return false;
        });
    });
    var columnId = "";

    active.setting = function () {
        layer.open({
            type: 1 //此处以iframe举例
            , title: '设置'
            , area: ['520px', '590px']
            , shade: 0.3
            , maxmin: true
            , content: "<div id='form1'>1111</div>"

        });
        var data = {
            "pager": {
                "current": 1,
                'size': 10
            }
        }

        layui.laytpl($("#setForms").html()).render({}, function (html) {
            $("#form1").html(html);
            var width = localStorage.getItem("width")
            var height = localStorage.getItem("height")
            var supForm = localStorage.getItem("supForm")
            var upsize = localStorage.getItem("upsize")
            if (width || height || supForm || upsize) {
                $("#width").val(width)
                $("#heights").val(height)
                $("#supForm").val(supForm);
                $("#upsize").val(upsize)
            }

            layui.form.on("select(selected)", function (data) {
                ajax("/manage/watermark/" + data.value, 'get').then(function (res) {
                    if (res.success) {
                        var wmkSign = res.obj.wmkSign
                        if (wmkSign === "1") {
                            localStorage.setItem('syType', "图片水印")
                        } else {
                            localStorage.setItem('syType', "文字水印")
                        }

                    }
                })
            })
            $(function () {
                $(".wrapper").numInput({
                    width: 90,//宽度
                    positive: true,//允许输入正数
                    negative: true,//允许输入负数
                    //faq：positive，negative不能同时false，同时false按同时为true处理
                    floatCount: 4,//小数点后保留位数
                    //命名空间，防止样式冲突
                    wrapperClass: 'num-input-wrap',//最外层容器
                    inputClass: 'num-input',//input输入框
                    addClass: 'add',//增加按钮
                    subtractClass: 'subtract',//减少按钮
                });
            })

            ajax('/manage/watermark/list', 'post', JSON.stringify(data)).then(function (res) {
                if (res.success) {
                    var records = res.obj.records;

                    var marks;
                    for (var i in records) {
                        marks += '<option value="' + records[i].id + '">' + records[i].name + '</option>'

                    }
                    $("#marks").append(marks)

                    layui.form.render();
                }
            })

        })
        var form = layui.form;
        form.on("submit(saveWaterMark)", function (data) {
            localStorage.setItem("width", data.field.width)
            localStorage.setItem("height", data.field.height)
            localStorage.setItem("supForm", data.field.supForm)
            localStorage.setItem("upsize", data.field.upsize)

            localStorage.setItem("markId", data.field.waterMark)
            layer.closeAll();
            return false;
        })
        form.on('radio(addSy)', function (data) {

            if (data.value === "是") {
                $("#sy").show()
            } else {
                $("#sy").hide()
            }
        });
        form.on('radio(picInfo)', function (data) {

            localStorage.setItem("picInfo", data.value)
        });
        form.on('radio(totalColumn)', function (data) {

            if (data.value === "是") {
                flag = true;
            } else {
                flag = false;
            }

        });
        layui.form.on("select(size)", function (data) {
            switch (data.value) {
                case "0":
                    $("#width").val("");
                    $("#heights").val("");
                    break;
                case "1":
                    $("#width").attr("disabled", false)
                    $("#heights").attr("disabled", false)
                    $("#width").val(1920);
                    $("#heights").val(1080);
                    break;
                case  "2":
                    $("#width").attr("disabled", false)
                    $("#heights").attr("disabled", false)
                    $("#width").val("");
                    $("#heights").val("");
                    break;
                case  "3":
                    $("#width").attr("disabled", false)
                    $("#heights").attr("disabled", false)
                    $("#width").val("");
                    $("#heights").val("");
                    break
                default:
                    $("#width").attr("disabled", true)
                    $("#heights").attr("disabled", true)
            }
        })


    }

    active.preview = function () {
        layer.msg("<div id='form9'></div>", {
            time: 0,
            closeBtn: 2,
            shade: 0.3,
            area: ['1300px', '530px']
        });
        layui.laytpl($("#detail").html()).render({}, function (html) {
            $("#form9").html(html);
            layui.form.render();
        })
        $('.image').click(function () { //这个视频被点击后执行
            var img = $(this).attr('vpath');//获取视频预览图
            var video = $(this).attr('ipath');//获取视频路径
            $('.videos').html("<video id=\"video\" poster='" + img + "' style='width: 795px;height:464px;' src='" + video + "' preload=\"auto\" controlsList=\"nodownload\" controls=\"controls\" autoplay=\"autoplay\"></video><img onClick=\"close1()\" class=\"vclose\" src=\"gb.png\" width=\"25\" height=\"25\"/>");
            $('.videos').show();
        });

        function close1() {
            var v = document.getElementById('video');//获取视频节点
            $('.videos').hide();//点击关闭按钮关闭暂停视频
            v.pause();
            $('.videos').html();
        }
    }

    function uploadImg() {
        if (false) {
            var that = this;
            //多窗口模式，层叠置顶
            layer.open({
                type: 1 //此处以iframe举例
                , title: '上传到'
                , area: ['502px', '452px']
                , shade: 0.3
                , maxmin: true
                , content: "<div id='form'></div>"
                , btn: ['开始上传', '取消'] //只是为了演示
                , btn2: function () {
                    layer.closeAll();
                }
                , yes: function () {
                    if (!columnId) {
                        layer.alert("请先选择栏目");
                        return;
                    }
                    layer.closeAll();
                    $("#list1").hide();
                    $('#list2').show();
                }

            });
            layui.laytpl($("#upload").html()).render({}, function (html) {
                $("#form").html(html);
                layui.form.render();
            })
        } else {
            $("#list2").show();
            $("#list1").hide();
        }
    }

    var imgArr = [];
    layui.use(['layer', 'element', 'form', 'upload'], function () {
        var layer = layui.layer,
            element = layui.element,
            form = layui.form,
            upload = layui.upload;

        //创建监听函数
        var xhrOnProgress = function (fun) {
            xhrOnProgress.onprogress = fun; //绑定监听
            //使用闭包实现监听绑
            return function () {
                //通过$.ajaxSettings.xhr();获得XMLHttpRequest对象
                var xhr = $.ajaxSettings.xhr();
                //判断监听函数是否为函数
                if (typeof xhrOnProgress.onprogress !== 'function')
                    return xhr;
                //如果有监听函数并且xhr对象支持绑定时就把监听函数绑定上去
                if (xhrOnProgress.onprogress && xhr.upload) {
                    xhr.upload.onprogress = xhrOnProgress.onprogress;
                }
                return xhr;
            }
        }
        var currNode = global.zTreeObj.getSelectedNodes()[0];
        var uploadFile = upload.render({
            elem: '#chooseFile', //绑定元素
            url: getAjaxUrl(service_prefix.resources,'/picture/upload?id=' + currNode.imgColumn), //上传接口
            exts: 'jpg|png|jpeg',//限定上传类型
            //accept: images,//指定允许上传时校验的文件类型 images（图片）、file（所有文件）、video（视频）、audio（音频）
            acceptMime: 'image/jpg, image/png, image/jpeg',//只筛选上述类型图片
            //number： '0',//0为不限制上传数量
            xhr: xhrOnProgress,
            //data: {}, //可选项 额外的参数，如：{id: 123, abc: 'xxx'}
            multiple: true,// 开启多文件上传
            drag: true, //是否允许拖拽上传
            size: 1024 * 0,//为0为不限制大小
            data: {
                keyword:"",
                customKeyword:""
            }, //可选项 额外的参数，如：{id: 123, abc: 'xxx'}
            //监听xhr进度，并返回给进度条
            progress: function (value) { //上传进度回调 value进度值
                element.progress('upload_progress', value + '%') //设置页面进度条
            },
            before: function (obj) {
                //开始上传时候让进度条去除隐藏状态
                $("#upload_progress").removeClass("layui-hide");
            },
            done: function (res, index, upload) {//在多文件上传中 每次成功将被调用一次
                if (res) {//此处只用于单文件图片的上传，若为多图片多文件请做其他处理
                    ajax(service_prefix.resources,"/picture/"+res.id,"put",JSON.stringify({tableid:currNode.tableId,dataId:global.editMetadataId})).then(res=>{
                        $("#list2").hide();
                        $("#list1").show();
                        getImgList(obj);
                    })
                }
                //获取当前触发上传的元素
                //var item = this.item;
            },
            error: function (index, upload) {
                //请求异常回调
                layer.close(layer.index);
                layer.confirm("上传失败，您是否要重新上传？", {
                    btn: ['确定', '取消'],
                    icon: 3,
                    title: "提示"
                }, function () {
                    //关闭询问框
                    layer.closeAll();
                    //重新调用上传方法
                    uploadFile.upload();
                })
            }
        });
    })

    function deletePic(event) {
    }

    function downLoadPic(id, event) {
        event.stopPropagation();

        window.location.href = url + "/downLoad?id=" + id;
    }


    function deletes(id, event) {
        event.stopPropagation();
        var that = this;
        //多窗口模式，层叠置顶
        layer.open({
            type: 1 //此处以iframe举例
            , title: '提示'
            , area: ['380px', '221px']
            , shade: 0.3
            , maxmin: true
            , content: "<div style='text-align:center;line-height:120px;'>确认要删除该图片及其信息？</div>"
            , btn: ['确定', '取消'] //只是为了演示
            , yes: function () {
                ajax(url + "/" + id, 'delete').then(function (res) {
                    if (res.success) {
                        layer.closeAll();
                        getImgList(obj);
                    }
                })
            }
            , btn2: function () {
                layer.closeAll();
            }

        });
    }
</script>
<script type="text/html" id="setForms">
    <form class="layui-form" style="margin-top: 10px;">
        <div class="layui-form-item">
            <label class="layui-form-label" style="padding:  9px 0px 9px 15px;width:95px;text-align: left;margin-left: 24px">压缩比例</label>
            <div class="layui-input-block" style="width: 300px;margin-left: 140px;">
                <select name="compress" id="" lay-filter="size">
                    <option value="" selected>请选择压缩比例</option>
                    <option value="0">保持原始尺寸</option>
                    <option value="1">适合电脑尺寸</option>
                    <option value="2">适合手机尺寸</option>
                    <option value="3">自定义</option>
                </select>
            </div>
        </div>
        <div class="layui-form-item">
            <label class="layui-form-label" style="padding:  9px 0px 9px 15px;width:95px;text-align: left;margin-left: 24px">选择尺寸</label>
            <div class="layui-input-block" style="width: 100px;margin-left: 10px;display: inline-block">
                <input type="text" class="layui-input" name="width" id="width" disabled>
            </div>
            <div class="layui-input-block" style="width: 100px;margin-left: 10px;display: inline-block">
                <input type="text" class="layui-input" name="height" id="heights" disabled>
            </div>
        </div>
        <div class="layui-form-item">
            <label class="layui-form-label" style="padding:  9px 0px 9px 15px;width:120px;text-align: left;margin-left: 24px">图片信息是否抽取</label>
            <div class="layui-input-block" style="width: 300px;margin-left: 140px;">
                <input type="radio" name="sex" value="是" title="是" lay-filter="picInfo">
                <input type="radio" name="sex" value="否" title="否" lay-filter="picInfo" checked>
            </div>
        </div>
        <div class="layui-form-item">
            <label class="layui-form-label" style="padding:  9px 0px 9px 15px;width:95px;text-align: left;margin-left: 24px">支持格式</label>
            <div class="layui-input-block" style="width: 300px;margin-left: 140px;">
                <input type="text" class="layui-input" autocomplete="off" name="supForm" id="supForm" value="jpg">
            </div>
        </div>
        <div class="layui-form-item">
            <label class="layui-form-label" style="padding:  9px 0px 9px 15px;width:95px;text-align: left;margin-left: 24px">上传大小</label>
            <div class="layui-input-block" style="width: 300px;margin-left: 140px;">
                <input type="text" class="layui-input" autocomplete="off" name="upsize" id="upsize" placeholder="单位默认KB">
            </div>
        </div>
        <div class="layui-form-item">
            <label class="layui-form-label" style="padding:  9px 0px 9px 15px;width:95px;text-align: left;margin-left: 24px">所属版权</label>
            <div class="layui-input-block" style="width: 300px;margin-left: 140px;">
                <select name="copyRight" id="">
                    <option value="" disabled selected hidden>请选择</option>
                    <option value="原创">原创</option>
                    <option value="自主">自主</option>
                    <option value="经授权">经授权</option>
                </select>
            </div>
        </div>
        <div class="layui-form-item">
            <label class="layui-form-label" style="padding:  9px 0px 9px 15px;width:95px;text-align: left;margin-left: 24px">汇总子栏目</label>
            <div class="layui-input-block" style="width: 300px;margin-left: 140px;">
                <input type="radio" name="sex" value="是" title="是" lay-filter="totalColumn">
                <input type="radio" name="sex" value="否" title="否" lay-filter="totalColumn">
            </div>
        </div>
        <div class="layui-form-item">
            <label class="layui-form-label" style="padding:  9px 0px 9px 15px;width:95px;text-align: left;margin-left: 24px">水印</label>
            <div class="layui-input-block" style="width: 300px;margin-left: 5px;float: left;">
                <select name="waterMark" id="marks" lay-filter="selected">
                    <option value="" disabled selected hidden>请选择水印</option>
                </select>
            </div>
            <button class="layui-btn layui-btn-primary layui-bg-gray" style="float:left;display: none" onclick="addSys()" type="button" id="sy">新建水印</button>
        </div>

        <div class="layui-btn-container" style="margin: 35px 170px;">
            <button class="layui-btn" type="button" lay-submit lay-filter="saveWaterMark">确定</button>
            <button class="layui-btn layui-btn-primary" onclick="layer.closeAll()" type="button">取消</button>
        </div>
    </form>
</script>
<script type="text/html" id='detail'>
    <div class='prev'>
        <i class='layui-icon layui-icon-left'></i>
    </div>
    <div class='box'>
        <div class='left' style="width: 600px;">
            <div class='image' style='position:relative;'>
                <img src="{{'/files' + d.path.substring(12)}}" width="100%" height="100%"/>
            </div>

        </div>
        <div class='rights'>
            <div class='layui-btn-container' style='margin-top:10px;'>
                {{#if(d.resParentId!=0){ }}
                <button class='layui-btn layui-btn-normal layui-btn-sm' style='margin-left:10px;' id="lookOld" onclick="lookOld('{{d.resParentId}}')">查看原图</button>
                {{#} }}
                <button class='layui-btn layui-btn-normal layui-btn-sm' style='margin-left:10px;'>生成手机版图片</button>
                <button class='layui-btn layui-btn-normal layui-btn-sm' style='margin-left:10px;'>生成电脑版图片</button>
                <button class='layui-btn layui-btn-normal layui-btn-sm' style='margin-left:10px;' onclick="deletes('{{d.id}}',event)"><i class=' layui-icon-delete'></i></button>
            </div>
            <p style='margin-top:20px; color:#666;text-align:left;'>名称：{{d.name}}</p>
            <p style='margin-top:10px; color:#666;text-align:left'>大小：{{d.size}}KB</p>
            <p style='margin-top:10px; color:#666;text-align:left'>格式：{{d.form}}</p>
            <p style='margin-top:10px; color:#666;text-align:left'>上传时间：{{d.createTime}}</p>
            <p style='margin-top:10px; color:#666;text-align:left'>路径：{{d.url}}</p>
            <p style='margin-top:10px; color:#666;text-align:left'>来源：{{d.resc}}</p>
            <p style='margin-top:10px; color:#666;text-align:left'>版权所属：{{d.copyright}}</p>
            <p style='margin-top:10px; color:#666;text-align:left'>创建人：{{d.crUser}}</p>
            {{#if(d.status===0){ }}
            <p style='margin-top:10px; color:#666;text-align:left'>图片状态：新稿</p>
            {{#} else if(d.status===10){ }}
            <p style='margin-top:10px; color:#666;text-align:left'>图片状态：审核</p>
            {{#} else if(d.status===20){ }}
            <p style='margin-top:10px; color:#666;text-align:left'>图片状态：发布</p>
            {{#} }}
            <div class="layui-btn-container" style="margin-top: 20px;">
                {{#if(d.status!=10){ }}
                <button class='layui-btn' onclick="changeState('审核','{{d.id}}')">审核</button>
                {{#} }}
                {{#if(d.status!=20){ }}
                <button class='layui-btn' onclick="changeState('发布','{{d.id}}')">发布
                    {{#} }}
                    <button class='layui-btn layui-btn-danger' onclick="update('{{d.id}}')">修改</button>
            </div>
        </div>
    </div>
    <div class='next'>
        <i class='layui-icon layui-icon-right'></i>
    </div>
</script>
<script>
    // layui.use('layer', function(){ //独立版的layer无需执行这一句
    //     var  layer = layui.layer; //独立版的layer无需执行这一句
    var ids1;

    function lookOld(id) {
        window.open(url + "/downLoad?id=" + id);
    }

    function changeState(status, id) {
        if (status === "审核") {
            var obj = {};
            obj.status = 10
            ajax("/picture/changeStatus?ids=" + id + "&status=" + obj.status, 'post').then(function (res) {
                if (res.success) {
                    layer.closeAll();
                    var data = {};
                    data.sign = 0;
                    getImgList(data)
                    localStorage.setItem("picId", "")
                }
            })
        } else {
            var obj = {};
            var status = 20

            ajax("/picture/changeStatus?ids=" + id + "&status=" + status, "post").then(function (res) {
                if (res.success) {
                    layer.closeAll();
                    localStorage.setItem("picId", id)
                    var data = {};
                    data.sign = 0;
                    getImgList(data)
                }
            })
        }
    }

    function update(id) {
        ids1 = id;

        ajax(url + "/" + id, "get").then(function (res) {
            if (res.success) {
                layer.closeAll();
                $("#list1").hide();
                $("#list7").show();

            }

            layui.laytpl($("#inner").html()).render(res.obj, function (html) {
                $("#editInfo").html(html);
                layui.form.val("info", res.obj);
                layui.form.render();
                var picInfo = localStorage.getItem('picInfo');
                if (picInfo === "是") {
                    $("#heads").show()
                } else {
                    $("#heads").hide()
                }
                ajax("/picture/getPicInfo?ids=" + id, 'post').then(function (res) {
                    if (res.success) {
                        layui.form.val("detailInfo", res.obj[0])
                    }
                })
                layui.form.render('select')
            })
        })
    }

    function search() {
        var name = $("#name").val();
        var creator = $("#creator").val();
        if (!name && !creator & !startTime & !endTime) {
            getImgList(obj)
        } else {
            obj.name = name;
            obj.crUser = creator;
            obj.startTime = startTime;
            obj.endTime = endTime;
            getImgList(obj)
        }
    }

    layui.form.on("submit(confirm)", function (data) {
        editInfo(data.field, ids1);

        return false;
    })
    function confirm1() {
        limitForm = localStorage.getItem('supForm')
        limitSize = localStorage.getItem("upsize")
        if (limitForm.split(",").indexOf(forms1) == -1) {
            layer.alert("该格式无法编辑,请选择正确的图片格式");
            return;
        }
        if (size > limitSize) {
            layer.alert("该图片尺寸过大,请选择合适大小的图片");
            return;
        }
        var obj = {};
        obj.name = $("#picName").val()
        obj.copyright = $("#belong").val()
        obj.resc = $("#resource").val()
        obj.desc = $("#ms").val();
        obj.path = $("#paths").val();
        obj.form = $("#forms").val();
        obj.size = $("#size").val();
        obj.scale = $("#scale").val()
        obj.reso = $("#reso").val()
        obj.style = $("#style").val();
        var id = JSON.parse(localStorage.getItem("uploadImg"))[0].id;
        ajax(url + "/" + id, "put", JSON.stringify(obj)).then(function (res) {
            if (res.success) {
                $("#list5").hide();
                $("#list1").show();
            }
        })
    }

    function editInfo(data, id) {
        ajax(url + "/" + id, "put", JSON.stringify(data)).then(function (res) {
            if (res.success) {
                $("#list7").hide();
                $("#list1").show();
                var obj = {};
                obj.sign = 0;
                getImgList(obj)
            }
        })
    }

    var colors = "", alpha = "", fontSize = "", picalpha = "";

    function addSys() {
        layer.open({
            type: 1 //此处以iframe举例
            , title: '设置水印'
            , area: ['520px', '590px']
            , shade: 0.3
            , maxmin: true
            , content: "<div id='form12'></div>"

        });
        layui.laytpl($("#syPage").html()).render({}, function (html) {
            $("#form12").html(html);
            layui.form.render();
        })
    }


</script>
<script type="text/html" id="syPage">
    <div class="layui-tab layui-tab-brief" lay-filter="docDemoTabBrief">
        <ul class="layui-tab-title" id="title" style="width: 400px;margin: 30px auto">
            <li class="layui-this">图片水印</li>
            <li>文字水印</li>
        </ul>
        <div class="layui-tab-content" style="height: 100px;">
            <div class="layui-tab-item layui-show" style="width: 400px;margin: 30px auto">

            </div>
            <div class="layui-tab-item" style="width: 400px;margin: 30px auto">


            </div>
        </div>
    </div>

</script>

<script>
    layui.form.on("submit(addShuiyin)", function (data) {

        $("#title li").each(function () {
            if ($(this).hasClass("layui-this")) {

                if ($(this).text() === "文字水印") {
                    localStorage.setItem('syType', $(this).text())
                    data.field.alpha = alpha;
                    data.field.fontSize = fontSize;
                    data.field.red = Number(colors.split("(")[1].split(",")[0]);
                    data.field.green = Number(colors.split("(")[1].split(",")[1].split("")[1]);
                    data.field.blue = Number(colors.split("(")[1].split(",")[2].split(")")[0]);
                    data.field.location = Number(data.field.location)
                    var id = "1177165361448071170"
                    ajax("/manage/watermark/edit", 'post', JSON.stringify(data.field)).then(function (res) {
                        if (res.success) {
                            layer.closeAll();
                        }
                    })
                } else {
                    localStorage.setItem('syType', $(this).text())
                    var obj = {};
                    obj.location = Number(data.field.location);
                    obj.picalpha = picalpha;
                    ajax("/manage/watermark/edit", 'post', JSON.stringify(obj)).then(function (res) {
                        if (res.success) {
                            layer.closeAll();
                        }
                    })
                }
            }
        })
    })
    $(function () {
        $('[data-magnify]').Magnify({
            Toolbar: [
                'prev',
                'next',
                'rotateLeft',
                'rotateRight',
                'zoomIn',
                'actualSize',
                'zoomOut'
            ],
            keyboard: true,
//            draggable:true,
//            movable:true,
            modalSize: [800, 600],
            beforeOpen: function (obj, data) {
            },
            opened: function (obj, data) {
            },
            beforeClose: function (obj, data) {
            },
            closed: function (obj, data) {
            },
            beforeChange: function (obj, data) {
            },
            changed: function (obj, data) {
            }
        });

    })

</script>
<script>


</script>
</body>

</html>