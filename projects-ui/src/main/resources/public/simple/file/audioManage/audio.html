<!DOCTYPE html>
<html lang="en">


<link rel="stylesheet" href="../../../thirdparty/tree/css/metroStyle/metroStyle.css">
<script src="https://cdn.bootcss.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://cdn.bootcss.com/respond.js/1.4.2/respond.min.js"></script>

<!-- <script src="../../../thirdparty/jquery/jquery-2.2.2.min.js"></script> -->
<script src="../../../thirdparty/tree/js/jquery.ztree.all.min.js"></script>
<link rel="stylesheet" href="../../../common/css/column.css">
<script src="../../../common/js/column_new.js"></script>
<style>
  #nav span,.right span{display: none;}
  #nav a{display: inline-block;width: 40px;height: 56px;text-align: center;border: 1px solid #f5f5f5;}
  #nav a:nth-of-type(3){display: inline-block;width: 220px;height: 52px; text-align: left;padding-left: 20px;border-top: 2px solid #000;font-weight: bold;}
  .right{display: inline-block;position: absolute;top: 0;right: 0;}
  .layui-breadcrumb a{color: #000!important;}
  #nav span,
  .right span {
    display: none;
  }
  #box{
    width: 160px;
    height: 80px;
    background: #fff;
    display: none;
    position: absolute;
    right: 183px;
    top: 58px;
    box-shadow: 0px 0px 5px #888888;
    border: 1px solid #000;
  }
  #box li{
    width: 150px;
    height: 40px;
    line-height: 40px;
    padding-left: 10px;
  }
  .active{
    background: #cccccc;
  }
  .videos{ display:none;width:795px;
    height:464px;
    background: url(../../../common/img//u6147.png) no-repeat;
    background-size: 100% 100%;
    position: absolute;top:0;left:0 }

  #nav a {
    display: inline-block;
    width: 40px;
    height: 56px;
    text-align: center;
    border: 1px solid #f5f5f5;
  }

  #nav a:nth-of-type(3) {
    display: inline-block;
    width: 220px;
    height: 52px;
    text-align: left;
    padding-left: 20px;
    border-top: 2px solid #000;
    font-weight: bold;
  }

  .right {
    display: inline-block;
    position: absolute;
    top: 0;
    right: 0;
  }

  .layui-breadcrumb a {
    color: #000 !important;
  }

  .node_name {
    font-size: 18px;
    color: rgb(102, 102, 102);
    margin-top: -5px;
    display: inline-block;
  }

  .ztree li {
    margin-top: 10px;
    padding: 0;
  }

  .ztree li span.button.noline_open {
    background-position: -110px -88px;
  }
  .ztree li span.button.noline_close {
    background-position: -130px -88px;
  }
  #list1 .layui-table td {
    padding: 0;
  }

  .imgBox {
    margin-top: 20px;
    margin-left: 30px;
  }

  .imgBox li {
    width: 230px;
    height: 180px;
    background: url(../../../common/img//transparent.gif) no-repeat;
    background-size: 100% 100%;
    float: left;
    margin-right: 25px;
    margin-bottom: 5px;
  }

  .imgBox li .img {
    width: 230px;
    height: 150px;
    background: url(../../../common/img/u8901.png) no-repeat;
    background-size: 100% 100%;
    position: relative;
  }
  .imgBox1 li{
    width: 100%;
    height: 115px;
    border-bottom: 1px solid #f5f5f5;
    position: relative;
  }
  .imgBox1 li .right{
    width: 140px;
    height: 70px;
    background: url(../../../common/img/u8901.png) no-repeat;
    background-size: 100% 100%;
    position: absolute;
    top:10px;
    left:15px;
  }
  .imgBox1 li .content{
    height: 70px;
    position: absolute;
    top:10px;
    left:175px;
  }
  .layui-table tbody tr:hover{
    background: #fff;
  }
  td .layui-input, .layui-select, .layui-textarea{
    border: none;
  }
  .inner1 li{
    float: left;
    margin-left: 15px;
  }
  .inner1 li:last-child{
    width: 175px;
    height: 197px;
    background: #f6f6f6;
    margin-top: 10px;
    position: relative;
  }
  .inner1 li:last-child img{
    position: absolute;
    top:40px;
    left: 30px;
  }
  #form2 .layui-form-select .layui-edge,#form3 .layui-form-select .layui-edge {
    position: absolute;
    right: 10px;
    top: 75%;}
  .box{width: 1300px;height: 690px;background: #fff}
  .layui-layer-hui .layui-layer-content{padding:0 25px;}
  .prev{
    width: 60px;
    height: 60px;
    border-radius: 30px;
    background: #ccc;
    position: absolute;
    line-height: 60px;
    top:250px;
    left: 30px;
  }
  .next{
    width: 60px;
    height: 60px;
    border-radius: 30px;
    background: #ccc;
    position: absolute;
    line-height: 60px;
    top:250px;
    right: 30px;
  }
  .image{
    width:600px;
    height:464px;
    background-size: 100% 100%;
  }
  .left{
    float: left;
    margin: 50px 50px 0 50px;
  }
  .rights{
    float: left;
    width: 350px;
    margin-left: 50px;
  }
  .layui-layer-hui{
    background: rgba(0,0,0,0);
  }
  .node_name{
    font-size: 14px;
  }
  .ztree {
    width: auto;
    overflow-y: hidden;
  }
  .layui-card-body {
    padding:0;
  }
  .layui-card-header {
    padding:0 12px;
  }
  /*#upload_preview{*/
  /*width: 230px;*/
  /*height: 146px;*/
  /*background: url(../../../common/img/u8901.png) no-repeat;*/
  /*}*/

    /* 转发 审核按钮 */

    .layui-layer-btn .layui-layer-btn0,
    .layui-layer-btn .layui-layer-btn1 {
    border: 1px solid #029687;
    padding: 2px 21px;
    }

    .layui-layer-btn .layui-layer-btn0 {
    background: #029687;
    }

    .tuisong .layui-input-block {
    margin-left: 0;
    }

    .tuisong .layui-inline {
    display: block;
    }
    /* .layui-btn{
      padding: 0 10px;
    } */
    #search {
    margin-right: 50px;
    margin-left: 10px;
    }

    .drwb {
    color: #333;
    }
</style>

<div class="layui-fluid">
  <div class="layui-row layui-col-space12">
    <div class="layui-col-md3 md2-left">
      <div class="layui-card" style="height: 800px; ">
        <div class="layui-card-header">音频管理
          <img src= "../../../common/img/u7869.png" alt="" style="float: right;margin-top: 12px ;cursor: pointer" onclick="setting()">
        </div>
        <div class="layui-card-body">
          <ul id="treeDemo" class="ztree"></ul>
        </div>
      </div>
    </div>
    <div class="layui-col-md9 md2-right">
      <div class="layui-card h100">
        <div class="layui-card-body">
          <div class="layui-tab layui-tab-card">
            <div class="layui-tab-content" style="height: 735px;overflow-y: auto;">
              <div class="layui-tab-item layui-show">
                <div class="layui-card " id='list1' style="height: 700px">
                  <form class="layui-form" style="display: inline-block;margin-top: 10px">
                    <div class="layui-form-item" style="display: inline-block;">
                      <label class="layui-form-label"
                             style="padding: 9px 10px;width:35px;text-align:center">名称:</label>
                      <div class="layui-input-block" style="width: 120px;margin-left: 60px;">
                        <input type="text" class="layui-input" placeholder="请输入" id="name">
                      </div>
                    </div>
                    <div class="layui-form-item" style="display: inline-block;">
                      <label class="layui-form-label"
                             style="padding: 9px 10px;width:50px;text-align:center">创建者:</label>
                      <div class="layui-input-block" style="width: 120px;margin-left: 70px;">
                        <input type="text" class="layui-input" placeholder="请输入" id="crUser">
                      </div>
                    </div>
                    <div class="layui-form-item" style="display: inline-block;">
                      <label class="layui-form-label"
                             style="padding: 9px 0 9px 15px;width:56px;text-align:center">上传时间</label>
                      <div class="layui-input-block" style="width: 190px;margin-left: 75px;">
                        <input type="text" class="layui-input" id="t12" placeholder=" - " style="text-align: center">
                      </div>
                    </div>
                  </form>
                  <div class="layui-btn-container"
                       style="display: inline-block;width: 675px;">
                    <button class="layui-btn" id="search" onclick="search()"><i
                        class="layui-icon layui-icon-search"></i></button>
<!--                    <button class="layui-btn" id="unpassAll">转发</button>-->
<!--                    <button class="layui-btn" id="passAll">审核</button>-->
                    <button class="layui-btn" onclick="delaudios()">批量删除</button>
<!--                    <button class="layui-btn" onclick="zCode()">批量转码</button>-->
<!--                    <button class="layui-btn" onclick="createCodes()">资源发布</button>-->
                    <button class="layui-btn"  data-method="upload" id="uploads">音频上传</button>
                  </div>
                  <ul id="box" >
                    <li><img src= "../../../common/img/u7412.png">&nbsp;&nbsp;&nbsp;<span class="txt">直接转码</span></li>
                    <li><img src= "../../../common/img/u7415.png">&nbsp;&nbsp;&nbsp;<span class="txt">进入转码任务</span></li>
                  </ul>
                  <div class="layui-form">
                    <table class="layui-table">
                      <colgroup>
                        <col width="130">
                        <col width="100">
                        <col width="100">
                        <col width="120">
                        <col>
                        <col width="40">
                        <col width="40">
                      </colgroup>
                      <tbody>
                      <tr>
                        <td>
                          <div class="layui-input-block" style="margin-left: 0;">
                            <select name="" id="">
                              <option value="0" selected>默认排序</option>
                              <option value="1">上传时间排序</option>
                              <option value="2">文件大小排序</option>
                            </select>
                          </div>
                        </td>
                        <td>
                          <div class="layui-input-block" style="margin-left: 0;">
                            <select name="" id="" lay-filter="time">
                              <option value="" selected>时长</option>
                              <option value="1">5以内</option>
                              <option value="2">5~30</option>
                              <option value="3">30以上</option>
                            </select>
                          </div>
                        </td>
                        <td>
                          <div class="layui-input-block" style="margin-left: 0;">
                            <select name="form" id="" lay-verify="required" lay-filter="forms">
                              <option value="" disabled selected hidden>格式</option>
                              <option value="全部">全部</option>
                              <option value="MP3">MP3</option>
                              <option value="WAV">WAV</option>
                              <option value="wma">wma</option>
                              <option value="asf">asf</option>
                              <option value="其他">其他</option>
                            </select>
                          </div>
                        </td>
                        <td>
                          <div class="layui-input-block" style="margin-left: 0;">
                            <select name="form" id="" lay-verify="required" lay-filter="copyright">
                              <option value="" disabled selected hidden>版权归属</option>
                              <option value="全部">全部</option>
                              <option value="自主">自主</option>
                              <option value="经授权">经授权</option>
                              <option value="其他">其他</option>
                            </select>
                          </div>
                        </td>
                        <td>
                          <div class="layui-input-block" style="margin-left: 0;">
                            <select name="form" id="" lay-verify="required" lay-filter="state">
                              <option value="" disabled selected hidden>音频状态</option>
                              <option value="0">新稿</option>
                              <option value="10">审核</option>
                              <option value="20">发布</option>
                            </select>
                          </div>
                        </td>
                        <td>
                          <div class="layui-input-block" style="margin-left: 0;width: 140px">
                            <select name="code" id="" lay-verify="required" lay-filter="code">
                              <option value="" disabled selected hidden>转码状态</option>
                              <option value="0">未转码</option>
                              <option value="2">已转码</option>
                            </select>
                          </div>
                        </td>
                        <td style="width: 400px"></td>
                        <td class="img1">
                          <img src="../../../common/img/u6616_mouseOver.png" alt="" srcset="" style="margin-left: 10px;" id='change1'>
                        </td>
                        <td class="img1">
                          <img src="../../../common/img/u6611.png" alt="" srcset="" style="margin-left: 10px;" id='change2' >
                        </td>
                      </tr>
                      </tbody>
                    </table>
                    <ul class="imgBox" id="audio" style="height: 490px;overflow: auto">



                    </ul>
                    <ul class="imgBox1" style="display: none;height: 490px;overflow: auto" id="audio1">

                    </ul>
                    <div id="test1" style="margin: 10px 0 0 30px;"></div>
                  </div>
                </div>
                <div class="layui-card" id="form9" style="display: none;height:700px"></div>
                <div class="layui-card " id='list2' style="display: none;height: 700px">
                  <div class="layui-card-header"><button class="layui-btn" style="float: right" onclick='returnBack()'>返回</button></div>
                  <div class="layui-card-body">
                    <div class='inner' style="width: 695px;height:234px;margin: 180px auto">
                      <form class="layui-form" method="post" action="javascript:;">

                        <div class="layui-form-item">

                          <div class="layui-inline">
                            <div class="layui-upload-drag" id="chooseFile" >
                              <p style="width: 100%;position: relative;left: -30px;"><i class="layui-icon layui-icon-upload" style="font-size: 35px"></i>&nbsp;&nbsp;&nbsp;<span style="position: absolute">点击上传</span></p>
                              <p style="margin-top:20px; color:#ccc;text-align: center;">--------------------------------------&nbsp;&nbsp;或&nbsp;&nbsp;--------------------------------------</p>
                              <p style="margin-top:20px; color:#0000ff;text-align: center;font-size: 20px;">从电脑里拖拽音频至此上传</p>
                              <p style="margin-top:20px; color:#ccc;text-align: center;color:#ccc;">支持mp3,asf,wma...等格式,图像大于72dpi,宽度大于2000px;（批量上传每次上限300个）</p>
                            </div>
                          </div>

                        </div>

                      </form>
                    </div>
                  </div>

                </div>
                <div class="layui-card h100" id='list3' style="display: none;height: 700px">
                  <div class="layui-card-header"><button class="layui-btn" style="float: right" onclick='returnBack1()'>返回</button></div>
                  <div class="layui-card-body">

                    <div class="inner1">
                      <div class="layui-main">
                        <div class="layui-inline" id="upload_preview"></div>
                      </div>
                      <form class="layui-form" style="margin-top: 360px">
                        <div class="layui-form-item">
                          <div class="layui-input-block" style="margin-left: 0">
                            <input type="checkbox" lay-filter="check" lay-skin="primary"  title="按默认设置处理（转码）">
                          </div>
                        </div>
                      </form>
                      <div class="edit" style="position: relative">
                        <button class="layui-btn layui-btn-normal layui-btn-lg" style="width: 265px;margin-top: 10px;display: inline-block;" onclick="edit()"><i class="layui-icon layui-icon-upload"></i>编辑音频</button>
                        <span style="margin-left: 15px;color:#666;display: inline-block;height: 44px;position: absolute;top:10px;line-height: 44px;">共3条音频（上传过程中请不要删除原始音频）</span>
                      </div>
                    </div>
                  </div>
                </div>
                <div class="layui-card h100" id='list5' style="display: none;height: 700px">
                  <div class="layui-card-header"><button class="layui-btn" style="float: right" onclick='returnBack3()'>返回</button></div>
                  <div class="layui-card-body">
                    <div class="inner3">
                      <h3 style="color: #169BD5;margin-left: 500px;margin-top:20px;font-weight:bold;display: inline-block;">单独新建信息</h3>
                      <div class="infoBox" style="width: 450px;height:610px;border-left:1px solid #ccc;float:right;margin-top: 60px;overflow: auto;">
                        <form class="layui-form" id='form3' lay-filter="audioInfo1">
                          <button class="layui-btn layui-btn-normal" style="width: 310px;margin:20px 0 20px 50px;" lay-submit lay-filter="confirms1" type="button">确定</button>
                          <div class="layui-form-item">
                            <label class="layui-form-label" style="text-align: left;">音频名称</label>
                            <div class="layui-input-block" style="width:320px;">
                              <input type="text" class="layui-input" placeholder="请输入内容" name="name">
                            </div>
                          </div>
                          <div class="layui-form-item">
                            <label class="layui-form-label" style="text-align: left;">*版权归属</label>
                            <div class="layui-input-block" style="width:320px;">
                              <input type="text" class="layui-input" name="copyright">
                            </div>
                          </div>
                          <div class="layui-form-item">
                            <label class="layui-form-label" style="text-align: left;">来源</label>
                            <div class="layui-input-block" style="width:320px;">
                              <input type="text" class="layui-input" placeholder="请输入内容" name="resc">
                            </div>
                          </div>
                          <div class="layui-form-item">
                            <label class="layui-form-label" style="text-align: left;">*描述</label>
                            <div class="layui-input-block" style="width:320px;">
                              <textarea class="layui-textarea" style="border: 1px solid #ccc" name="description"></textarea>
                            </div>
                          </div>
                          <div class="layui-form-item">
                            <label class="layui-form-label" style="text-align: left;">文件夹路径</label>
                            <div class="layui-input-block" style="width:320px;">
                              <input type="text" class="layui-input" placeholder="请输入内容" name="url">
                            </div>
                          </div>
                          <div class="layui-form-item">
                            <label class="layui-form-label" style="text-align: left;">格式</label>
                            <div class="layui-input-block" style="width:320px;">
                              <select name="form" id="">
                                <option value="mp3" selected>MP3</option>
                                <option value="wav">WAV</option>
                                <option value="asf">ASF</option>
                              </select>
                            </div>
                          </div>
                          <div class="layui-form-item">
                            <label class="layui-form-label" style="text-align: left;">文件大小</label>
                            <div class="layui-input-block" style="width:320px;">
                              <input type="text" class="layui-input" name="fsize">
                            </div>
                          </div>
                          <div class="layui-form-item">
                            <label class="layui-form-label" style="text-align: left;">时长</label>
                            <div class="layui-input-block" style="width:320px;">
                              <input type="text" class="layui-input" name="length">
                            </div>
                          </div>
                          <div class="layui-form-item">
                            <label class="layui-form-label" style="text-align: left;">上传时间</label>
                            <div class="layui-input-block" style="width:320px;">
                              <input type="text" class="layui-input" name="createTime">
                            </div>
                          </div>
                        </form>
                      </div>
                      <div class="imgIcon" style="width:379px;height:466px;margin: 50px 0 0 150px;position: relative;">
                        <div class='image' style="height: 379px;width: 466px;position: relative;">
                          <img src="../../../common/img/u8901.png" alt="" style="width: 100%;height:100%">
                          {{# var url = getAjaxUrl("",d.url)}}
                          <audio src="{{url}}" preload="auto" controlsList="nodownload" controls="controls" autoplay="autoplay"
                                 style="position: absolute;left:200px;bottom:15px;"></audio>


                        </div>
                      </div>
                    </div>
                  </div>
                </div>
                <div class="layui-card h100" id='list7' style="display: none;height: 700px">
                  <div class="layui-card-header"><button class="layui-btn" style="float: right" onclick='returnBack5()'>返回</button></div>
        <div class="layui-card-body">
          <div class="inner5" id="inner5">

          </div>
        </div>
      </div>
              </div>
              <div class="layui-tab-item" style="position: relative" id="main">
                <div class="search-bar">
                  <button class="layui-btn" onclick="addImgColumn()">新建栏目</button>
                  <button class="layui-btn" onclick="editByIds()">修改栏目</button>
                  <button class="layui-btn" onclick="delColumn2()">删除栏目</button>
                  <button class="layui-btn" id="import">导入栏目</button>
                  <button class="layui-btn" style="margin-left:10px;" id="export" onclick="exportExc()">导出栏目</button>
                  <form class="layui-form" action="" style="display: inline-block;float: right;">
                    <input type="text" name="title" placeholder="请输入" autocomplete="off" class="layui-input search-input" id="val">
                    <button class="layui-btn" type="button" onclick="searchColumn()"><i class="layui-icon">&#xe615;</i></button>
                  </form>
                </div>
                <ul class="uls" id="first" style="height: 630px;overflow-y: auto;clear: both;">
                </ul>
                <div id="demo8" align="center"></div>
              </div>
              <div class="layui-tab-item" id="columnDetail">
              </div>
            </div>
            <ul class="layui-tab-title">
              <li id="imgTab" class="layui-this">音频管理</li>
              <li id="columnTab">子栏目管理</li>
              <li id="infoTab" onclick="getColumnByIds()">基本信息</li>
            </ul>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
<script type="text/html" id="audios">
  {{# layui.each(d, function(index, item){ }}
  <li style="position: relative">
    <div class="img" >
      <!--<img src="{{'/files' + item.path.substring(9)}}"  style="width: 100%;height: 100%">-->

      <div class="layui-btn-container" style="position: absolute;right:0px;top:5px;">
      </div>
      <div style="width: 40px;height:40px;    position: absolute;
    top: 55px;
    left: 95px;" onclick="preview('{{item.id}}',event)">
        <img src="../../../common/img/u7603.png" alt="" style="width: 100%;height:100%;">
      </div>
      <p style="position: absolute;bottom:10px;right:10px;color: #FFFFFF">{{item.length}}</p>

    </div>
    <div class="checkDiv" style="position: absolute;left: 5px;bottom: 0px;">
      <input type="checkbox"  name="ids" lay-skin="primary" id="check" lay-filter="checked" value="{{item.id}}">
    </div>
    <div class="text" style="margin-top:10px;height: 20px;overflow: hidden;width: 150px;
text-overflow:ellipsis;white-space: nowrap;float: right;    margin-right: 40px;
    margin-top: 7px;">

      {{#if(item.status===0){ }}
      <span style="color: blue">新稿</span>
      {{#} else if(item.status===10){ }}
      <span style="color: blue">审核</span>
      {{#} else if(item.status===20){ }}
      <span style="color: blue">发布</span>
      {{#} }}
      |&nbsp;&nbsp;<span style="text-align: center" title="{{item.name}}.{{item.form}}">{{item.name}}.{{item.form}}</span>
    </div>
  </li>
  {{#  }); }}
  {{# if(d.length === 0){ }}
  无数据
  {{# } }}
</script>
<script type="text/html" id="audios1">
  {{# layui.each(d, function(index, item){ }}
  <li>
    <div class="right">
    </div>
    <div class="content">
      <p>{{item.name}}</p>
      <p style="margin-top: 15px;">
        <span>格式：{{item.form}}</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span>大小：{{item.fsize}}KB</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span>上传时间：2019年7月10日</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span>路径：首页 - banner新闻</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span>来源：版权来源</span>
      </p>
    </div>
    <div class="layui-btn-container" style="position: absolute;right:20px;top:30px;">

      <div class="layui-btn" onclick="downLoadAudio('{{item.id}}',event)">下载</div>
      <div class="layui-btn layui-btn-danger" onclick="deleteAudios('{{item.id}}',event)">删除</div>
    </div>
  </li>
  {{#  }); }}
  {{# if(d.length === 0){ }}
  无数据
  {{# } }}
</script>
<script>
  var url = '/picture';
  var bool=false;
  var tempSize=10;
  $(function () {
    getTreeData()
  }())
  layui.form.on('checkbox(check)',function (data) {
      var checked = data.elem.checked;
      var mp3Zcode=localStorage.getItem("mp3Zcode")
      if(checked){
          if(mp3Zcode==="否"||!mp3Zcode){
              return;
          }
          ajax(service_prefix.resources,"/picture/transMp3?ids="+ids,'post').then(function (res) {
              if(res.success){
                  getTreeData()
              }
          })
      }
  })

  function zCode() {
      var data = document.getElementsByName("ids")
      var count=0;
      for (var i in data){
          if (data[i].checked){
              if (count!==0){
                  ids+=",";
              }
              ids+=data[i].value;
              count++;

          }

      }
      if (ids===""){
          layer.alert("请选择要转码的音频")
          return false;
      }
//      ajax("/picture/transMp3?ids="+ids,'post').then(function (res) {
//          if(res.success){
//              getTreeData()
//          }
//  })
//      $("#box").show()
      toMp3();
  }

  function toMp3(){
      ajax(service_prefix.resources, "/picture/transMp3Thread?ids=" + ids, "post").then(function (res) {
          if (res.success) {
              layerOpen("提示", "380", "221", "form11")
              lodTpl("tips", "form11", {})
          }
      })
  }

  $("#box li").click(function () {
      var text =$(this).children("span").text();
      if(text==="直接转码"){
          alert(1)
      }else{
          layerOpen("提示","380","221","form11")
          lodTpl("tips","form11",{})
      }
      $("#box").hide()
  })
  $("#box li").hover(function () {
      $(this).addClass("active")
  },function () {
      $(this).removeClass("active")
  })
  function changeState(status,id) {
      if(status === "审核"){
          var obj={};
          obj.status=10
          ajax(service_prefix.resources,"/picture/changeStatus?ids="+id+"&status="+obj.status,'post').then(function (res) {
              if(res.success){
                  $("#form9").hide();
                $("audio").attr("src","");
                  $("#list1").show();
                  getTreeData()
                  localStorage.setItem("audioId","")
              }
          })
      }else{
          var obj={};
          var status=20
          ajax(service_prefix.resources,"/picture/changeStatus?ids="+id+"&status="+status,"post").then(function (res) {
              if(res.success){
                  $("#form9").hide();
                $("audio").attr("src","");
                  $("#list1").show();
                  getTreeData()
                  localStorage.setItem("audioId",id)
              }
          })
      }
  }
  function downLoadAudio(id,event) { //下载音频
    event.stopPropagation()
    window.location.href="/picture/downLoad?id="+id;
  }
  function createCodes() {
      var data = document.getElementsByName("ids")
      var ids="";
      var count=0;
      for (var i in data){
          if (data[i].checked){
              if (count!==0){
                  ids+=",";
              }
              ids+=data[i].value;
              count++;

          }

      }
      if (ids===""){
          layer.alert("请选择需要发布的音频")
          return false;
      }
      var id =localStorage.getItem("audioId");
      console.log(id)
      if(id&&id===ids){
          layer.alert("该音频已发布过，请重新选择其他音频发布");
          return false
      }
      changeState("发布",ids)
  }
  var startTime="",endTime="";
  layui.use('laydate', function() {  //日期显示组件
      var laydate = layui.laydate;
      laydate.render({
          elem: '#t12'
          ,range: true
          ,done:function (value) {
              startTime=value.split(' -')[0]
              endTime =value.split('- ')[1]
          }
      });

  })
  function search() {
    var crUser =$("#user").val();
    var name =$("#name").val();
    if(!name&&!crUser&&!startTime&&!endTime){
      getAudioList(1,{})
    }else{
      var obj={};
      obj.name=name;
      obj.crUser=crUser;
      obj.startTime=startTime;
      obj.endTime=endTime;
      getAudioList(1,obj);
    }
  }
  var forms="";
  var copyright="";
  var timeRange=0;
  var form = layui.form;
  var status;
  var code;
  form.on('select(state)',function (data) {
      status=data.value

  })
  form.on('select(code)',function (data) {
      code=data.value

  })
  form.on("select(forms)",function (data) {
    forms=data.value;
  })
  form.on("select(time)",function (data) {
    console.log(data.value);
    switch (data.value){
      case "0":
        getAudioList(1,{});
        break;
      case "1":
        var obj={};
        obj.sign=3;
        curr=1;
        tempSize=10;
        var jsonData={
          "pager": {
            "current": curr,
            "size": tempSize,
          },
          "picture":obj
        }
        ajax(service_prefix.resources,url+"/list",'post',JSON.stringify(jsonData)).then(function (res) {
          console.log(res);
          layui.use('laypage', function(){
            var laypage = layui.laypage;

            //执行一个laypage实例
            laypage.render({
              elem: 'test1'
              ,count:res.obj.total
              ,curr:res.obj.current
              ,limit:res.obj.size
              ,layout:['count','prev','page','next','limit','refresh','skip']
              ,jump:function (obj,first) {
                if (!first){
                  curr=obj.curr
                  tempSize=obj.limit
                  var obj1={};
                  obj1.sign=3
                  getAudioList(curr,obj1);
                }
              }
            }); 
          });
          var obj = res.obj.records;
          var arr = obj.filter(function (item) {
            return Number(item.length.slice(1,2))<5||Number(item.length.slice(1,2))===5;
          })
          layui.laytpl($("#audios").html()).render(arr, function(html){
            $("#audio").html(html);
            layui.form.render();
          })
          layui.laytpl($("#audios1").html()).render(arr, function(html){
            $("#audio1").html(html);
            layui.form.render();
          })
        })
        break
      case "2":
        var obj={};
        obj.sign=3;
        curr=1;
        tempSize=10;
        var jsonData={
          "pager": {
            "current": curr,
            "size": tempSize,
          },
          "picture":obj
        }
        ajax(service_prefix.resources,url+"/list",'post',JSON.stringify(jsonData)).then(function (res) {
          console.log(res);
          layui.use('laypage', function(){
            var laypage = layui.laypage;

            //执行一个laypage实例
            laypage.render({
              elem: 'test1'
              ,count:res.obj.total
              ,curr:res.obj.current
              ,limit:res.obj.size
              ,layout:['count','prev','page','next','limit','refresh','skip']
              ,jump:function (obj,first) {
                if (!first){
                  curr=obj.curr
                  tempSize=obj.limit
                  var obj1={};
                  obj1.sign=3
                  getAudioList(curr,obj1);
                }
              }
            });
          });
          var obj =res.obj.records;
          var arr = obj.filter(function (item) {
            return Number(item.length.slice(1,2))>5&&Number(item.length.slice(1,2))<30;
          })
          console.log(arr)
          layui.laytpl($("#audios").html()).render(arr, function(html){
            $("#audio").html(html);
            layui.form.render();
          })
          layui.laytpl($("#audios1").html()).render(arr, function(html){
            $("#audio1").html(html);
            layui.form.render();
          })
        })
        break
      case "3":
        var obj={};
        obj.sign=3;
        curr=1;
        tempSize=10;
        var jsonData={
          "pager": {
            "current": curr,
            "size": tempSize,
          },
          "picture":obj
        }
        ajax(service_prefix.resources,url+"/list",'post',JSON.stringify(jsonData)).then(function (res) {
          console.log(res);
          layui.use('laypage', function(){
            var laypage = layui.laypage;

            //执行一个laypage实例
            laypage.render({
              elem: 'test1'
              ,count:res.obj.total
              ,curr:res.obj.current
              ,limit:res.obj.size
              ,layout:['count','prev','page','next','limit','refresh','skip']
              ,jump:function (obj,first) {
                if (!first){
                  curr=obj.curr
                  tempSize=obj.limit
                  var obj1={};
                  obj1.sign=3
                  getAudioList(curr,obj1);
                }
              }
            });
          });
          var obj =res.obj.records;
          var arr = obj.filter(function (item) {
            return Number(item.length.slice(1,2))>30&&Number(item.length.slice(1,2))===30;
          })
          console.log(arr)
          layui.laytpl($("#audios").html()).render(arr, function(html){
            $("#audio").html(html);
            layui.form.render();
          })
          layui.laytpl($("#audios1").html()).render(arr, function(html){
            $("#audio1").html(html);
            layui.form.render();
          })
        })
        break
    }
  })
  form.on("select(copyright)",function (data) {
    forms=data.value
  })
  form.on("select",function (data) {
    if(forms===""||forms==="全部"){
      forms="";
    }
    if(copyright===""||copyright==="全部"){
      copyright="";
    }
    var obj={};
    obj.copyright=copyright;
    obj.form=forms;
    obj.status=status
      obj.processing=Number(code);
    getAudioList(1,obj);
  })
  function preview(id,event) {
    event.stopPropagation()
      localStorage.setItem('id4',id)
      $("#list1").hide();
    $("#form9").show();
    ajax(service_prefix.resources,url+"/getMp3Info?ids="+id,"post").then(function(res){
      if(res.success){
        if(res.obj[0].length===0){
          $("#heads1").hide();
          return;
        }
        $("#detai1").val(res.obj[0][0])
        $("#detai2").val(res.obj[0][1])
        $("#detai3").val(res.obj[0][2])
        $("#detai4").val(res.obj[0][3])
      }
    })
    ajax(service_prefix.resources,url+"/"+id,'get').then(function (res) {

      layui.laytpl($("#detail").html()).render(res.obj, function (html) {
        $("#form9").html(html);
        layui.form.render();
          var picInfo=localStorage.getItem('picInfo2');
          if(picInfo==="是"){
              console.log(1)
              $("#heads1").show()
          }else{
              $("#heads1").hide()
          }
        layui.use('element', function(){
          var $ = layui.jquery
                  ,element = layui.element; //Tab的切换功能，切换事件监听等，需要依赖element模块

          //触发事件
          var active = {
            tabAdd: function(){
              //新增一个Tab项
              element.tabAdd('demo', {
                title: '新选项'+ (Math.random()*1000|0) //用于演示
                ,content: '内容'+ (Math.random()*1000|0)
                ,id: new Date().getTime() //实际使用一般是规定好的id，这里以时间戳模拟下
              })
            }
            ,tabDelete: function(othis){
              //删除指定Tab项
              element.tabDelete('demo', '44'); //删除：“商品管理”


              othis.addClass('layui-btn-disabled');
            }
            ,tabChange: function(){
              //切换到指定Tab项
              element.tabChange('demo', '22'); //切换到：用户管理
            }
          };

          $('.site-demo-active').on('click', function(){
            var othis = $(this), type = othis.data('type');
            active[type] ? active[type].call(this, othis) : '';
          });

          //Hash地址的定位
          var layid = location.hash.replace(/^#test=/, '');
          element.tabChange('test', layid);

          element.on('tab(test)', function(elem){
            location.hash = 'test='+ $(this).attr('lay-id');
          });

        });
      })
    })


  }
  var audios=JSON.parse(localStorage.getItem("audios"))
  var srcArr=[]
  var ids1=[]
  var indexs=0
  for(var i in audios){
      srcArr.push(audios[i].url)
      ids1.push(audios[i].id)
  }
  var id1=localStorage.getItem("id4")
  for(var i in ids1) {
      if (id1 === ids1[i]) {
          indexs = i;
      }
  }
  console.log(indexs)
  function next() {
      indexs++;
      console.log(indexs,srcArr.length-1);
//              return;
      if(indexs>srcArr.length-1){
          layer.alert("已经到了最后一个音频了");
          return;
      }
      ajax(service_prefix.resources,url+"/"+ids1[indexs],'get').then(function (res) {

          layui.laytpl($("#detail").html()).render(res.obj, function (html) {
              $("#form9").html(html);
              layui.form.render();
              var picInfo=localStorage.getItem('picInfo2');
              if(picInfo==="是"){
                  console.log(1)
                  $("#heads1").show()
              }else{
                  $("#heads1").hide()
              }
              layui.use('element', function(){
                  var $ = layui.jquery
                      ,element = layui.element; //Tab的切换功能，切换事件监听等，需要依赖element模块

                  //触发事件
                  var active = {
                      tabAdd: function(){
                          //新增一个Tab项
                          element.tabAdd('demo', {
                              title: '新选项'+ (Math.random()*1000|0) //用于演示
                              ,content: '内容'+ (Math.random()*1000|0)
                              ,id: new Date().getTime() //实际使用一般是规定好的id，这里以时间戳模拟下
                          })
                      }
                      ,tabDelete: function(othis){
                          //删除指定Tab项
                          element.tabDelete('demo', '44'); //删除：“商品管理”


                          othis.addClass('layui-btn-disabled');
                      }
                      ,tabChange: function(){
                          //切换到指定Tab项
                          element.tabChange('demo', '22'); //切换到：用户管理
                      }
                  };

                  $('.site-demo-active').on('click', function(){
                      var othis = $(this), type = othis.data('type');
                      active[type] ? active[type].call(this, othis) : '';
                  });

                  //Hash地址的定位
                  var layid = location.hash.replace(/^#test=/, '');
                  element.tabChange('test', layid);

                  element.on('tab(test)', function(elem){
                      location.hash = 'test='+ $(this).attr('lay-id');
                  });

              });
          })
      })
  }
  function prev1() {
      indexs--;
      if(indexs<0){
          layer.alert("已经到了第一个音频了");
          return;
      }
      ajax(service_prefix.resources,url+"/"+ids1[indexs],'get').then(function (res) {

          layui.laytpl($("#detail").html()).render(res.obj, function (html) {
              $("#form9").html(html);
              layui.form.render();
              var picInfo=localStorage.getItem('picInfo2');
              if(picInfo==="是"){
                  console.log(1)
                  $("#heads1").show()
              }else{
                  $("#heads1").hide()
              }
              layui.use('element', function(){
                  var $ = layui.jquery
                      ,element = layui.element; //Tab的切换功能，切换事件监听等，需要依赖element模块

                  //触发事件
                  var active = {
                      tabAdd: function(){
                          //新增一个Tab项
                          element.tabAdd('demo', {
                              title: '新选项'+ (Math.random()*1000|0) //用于演示
                              ,content: '内容'+ (Math.random()*1000|0)
                              ,id: new Date().getTime() //实际使用一般是规定好的id，这里以时间戳模拟下
                          })
                      }
                      ,tabDelete: function(othis){
                          //删除指定Tab项
                          element.tabDelete('demo', '44'); //删除：“商品管理”


                          othis.addClass('layui-btn-disabled');
                      }
                      ,tabChange: function(){
                          //切换到指定Tab项
                          element.tabChange('demo', '22'); //切换到：用户管理
                      }
                  };

                  $('.site-demo-active').on('click', function(){
                      var othis = $(this), type = othis.data('type');
                      active[type] ? active[type].call(this, othis) : '';
                  });

                  //Hash地址的定位
                  var layid = location.hash.replace(/^#test=/, '');
                  element.tabChange('test', layid);

                  element.on('tab(test)', function(elem){
                      location.hash = 'test='+ $(this).attr('lay-id');
                  });

              });
          })
      })

  }
  function getAudioList(curr,obj) {
    obj.sign=3;
    var jsonData={
      "pager": {
        "current": curr,
        "size": tempSize
            , "sortProps": [
                {
                    "key": "datetime",
                    "value": false
                }
            ]
      },
      "picture":obj
    }
    ajax(service_prefix.resources,url+"/list",'post',JSON.stringify(jsonData)).then(function (res) {
      console.log(res);
      localStorage.setItem("audios",JSON.stringify(res.obj.records))
      layui.use('laypage', function(){
        var laypage = layui.laypage;

        //执行一个laypage实例
        laypage.render({
          elem: 'test1'
          ,count:res.obj.total
          ,curr:res.obj.current
          ,limit:res.obj.size
          ,layout:['count','prev','page','next','limit','refresh','skip']
          ,jump:function (obj,first) {
            if (!first){
              curr=obj.curr
              tempSize=obj.limit
              var obj1={};
              obj1.sign=3
              getAudioList(curr,obj1);
            }
          }
        });
      });
      layui.laytpl($("#audios").html()).render(res.obj.records, function(html){
        $("#audio").html(html);
        layui.form.render();
      })
      layui.laytpl($("#audios1").html()).render(res.obj.records, function(html){
        $("#audio1").html(html);
        layui.form.render();
      })
    })
  }
  var url = '/picture';
  function delaudios() {
      var data = document.getElementsByName("ids")
      var ids="";
      var count=0;
      for (var i in data){
          if (data[i].checked){
              if (count!==0){
                  ids+=",";
              }
              ids+=data[i].value;
              count++;

          }

      }
      if (ids===""){
          layer.alert("请选择要删除的音频")
          return false;
      }
      delaudio(ids)
  }
  function delaudio(ids) { //批量删除视频
      ajax(service_prefix.resources,"/picture/delByIds?ids="+ids,"get").then(function (res) {
          console.log(res)
          if(res.success){
              getTreeData()
          }
      })
  }
  function collect(id,event) {
      var src = event.target.getAttribute('src')
      if(src==="../../../common/img/u582.png"){
          event.target.setAttribute('src',"../../../common/img/u582_mouseOver.png")
          ajax(service_prefix.resources,url+"/changeCollect?id="+id,'post').then(function (res) {
              console.log(res)
          })
      }else if( src==="../../../common/img/u582_mouseOver.png"){
          event.target.setAttribute('src',"../../../common/img/u582.png")
          ajax(service_prefix.resources,url+"/changeCollect?id="+id,'post').then(function (res) {
              console.log(res)
          })
      }
  }
  function deleteAudios(id,event) {
    event.stopPropagation()
    layer.open({
      type: 1 //此处以iframe举例
      ,title: '提示'
      ,area: ['380px', '221px']
      ,shade: 0.3
      ,maxmin: true
      ,content: "<div style='text-align:center;line-height:120px;'>确认要删除？</div>"
      ,btn: ['确定', '取消'] //只是为了演示
      ,btn2: function(){
        layer.closeAll();
      },
      yes:function () {
        ajax(service_prefix.resources,url+"/delByIds?ids="+id,'get').then(function (res) {
          if(res.success){
              $("#form9").hide();
            $("audio").attr("src","");
              $("#list1").show();
              layer.closeAll();
            getTreeData()
          }
        })
      }

    });
  }
  var zNodes;
  /*ztree*/
  function getTreeData() { //获取左侧树结构的数据
    getColumnTreeData(5,0).then(function (resdata) {
      global.zTreeObj = $.fn.zTree.init($("#treeDemo"), settingss, resdata); //初始化树
      var node = global.zTreeObj.getNodeByTId("treeDemo_4");
      global.zTreeObj.expandAll(true); //true 节点全部展开、false节点收缩
      global.zTreeObj.selectNode(node);
      settingss.callback.onClick(null, global.zTreeObj.setting.treeId, node);
    });
  }

  var settingss = {
    data: {
      simpleData: {
        enable: true,  //true 、 false 分别表示 使用 、 不使用 简单数据模式
        idKey: "id",  //节点数据中保存唯一标识的属性名称
        pIdKey: "parentId",    //节点数据中保存其父节点唯一标识的属性名称
        rootPId: -1  //用于修正根节点父节点数据，即 pIdKey 指定的属性值
      },
      key: {
        name: "name"  //zTree 节点数据保存节点名称的属性名称  默认值："name"
      }
    },
    view: {showLine: false, showIcon: true},
    callback:{
      onClick:zTreeOnClick1
    }
  };

  function zTreeOnClick1(event, treeId, treeNode) {
    console.log(treeNode)
    if(treeNode.level==1){
      siteObj = treeNode;
      columnObj = "";
    }else if(treeNode.level>=2){
      columnId=treeNode.id;
      columnObj = treeNode;
      var parents = treeNode.getPath();
      parents.forEach(function(res) {
        if(res.level == 1){
          siteObj = res;
        }
      })
    }
    columnList(1,siteObj.id,columnObj.id);

    var ids= treeNode.id;
    var obj={};
    bool=true;
      if(treeNode.level<2){
          $("#uploads").hide();
      }else{
          $("#uploads").show()
      }
      if(treeNode.level===0){
          obj={
              "pager": {
                  "current": 1,
                  "size": 10
              },
              "picture": {
                  "companyId":  treeNode.id,
                  "sign": 3
              }
          };
      }else if(treeNode.level===1){
          obj={
              "pager": {
                  "current": 1,
                  "size": 10
              },
              "picture": {
                  "siteId":  treeNode.id,
                  "sign": 3
              }
          }
      }else{
          obj={
              "pager": {
                  "current": 1,
                  "size": 10
              },
              "picture": {
                  "columnId":  treeNode.id,
                  "sign": 3
              }
          };
      }
    ajax(service_prefix.resources,url+"/list",'post',JSON.stringify(obj)).then(function (res) {
      console.log(res)
        localStorage.setItem("audios",JSON.stringify(res.obj.records))
      layui.use('laypage', function(){
        var laypage = layui.laypage;

        //执行一个laypage实例
        laypage.render({
          elem: 'test1'
          ,count:res.obj.total
          ,curr:res.obj.current
          ,limit:res.obj.size
          ,layout:['count','prev','page','next','limit','refresh','skip']
          ,jump:function (obj,first) {
            if (!first){
              curr=obj.curr
              tempSize=obj.limit
              var obj1={};
              obj1.sign=3
              getAudioList(curr,obj1);
            }
          }
        });
      });
      layui.laytpl($("#audios").html()).render(res.obj.records, function(html){
        $("#audio").html(html);
        layui.form.render();
      })
      layui.laytpl($("#audios1").html()).render(res.obj.records, function(html){
        $("#audio1").html(html);
        layui.form.render();
      })
    })
  }

</script>

<script>

  var columnId="";

  var siteObj;
  var columnObj;
  var idArr=[];
  var uploadFile;
  var imgArr =[];
  function add(){
    $('#list4').hide();
    $('#list5').show();
  }

  function initUploadBtn(){
    layui.use([ 'layer', 'element', 'form', 'upload' ], function() {
      var layer = layui.layer,
              element = layui.element,
              form = layui.form,
              upload = layui.upload;

      //创建监听函数
      var xhrOnProgress = function(fun) {
        xhrOnProgress.onprogress = fun; //绑定监听
        //使用闭包实现监听绑
        return function() {
          //通过$.ajaxSettings.xhr();获得XMLHttpRequest对象
          var xhr = $.ajaxSettings.xhr();
          //判断监听函数是否为函数
          if (typeof xhrOnProgress.onprogress !== 'function')
            return xhr;
          //如果有监听函数并且xhr对象支持绑定时就把监听函数绑定上去
          if (xhrOnProgress.onprogress && xhr.upload) {
            xhr.upload.onprogress = xhrOnProgress.onprogress;
          }
          return xhr;
        }
      }
      var form="mp3|wma|flac";
      var form1;
      if(localStorage.getItem("audioForm")){
        form1=localStorage.getItem("audioForm").split(",").join("|")+"|"+form;
      }

      var supForm=form1||form
      uploadFile = upload.render({
        elem : '#chooseFile', //绑定元素
        url : getAjaxUrl(service_prefix.resources,'/picture/radioupload?id=' +  columnId), //上传接口
        exts : supForm,//限定上传类型
        //accept: images,//指定允许上传时校验的文件类型 images（图片）、file（所有文件）、video（视频）、audio（音频）
//                    acceptMime : 'image/jpg, image/png, image/jpeg',//只筛选上述类型图片
        //number： '0',//0为不限制上传数量
        xhr : xhrOnProgress,
        //data: {}, //可选项 额外的参数，如：{id: 123, abc: 'xxx'}
        multiple: true,// 开启多文件上传
        drag:true, //是否允许拖拽上传
        size: 1024*0,//为0为不限制大小
        //监听xhr进度，并返回给进度条
        progress : function(value) { //上传进度回调 value进度值
          console.log(value);
          element.progress('upload_progress', value + '%') //设置页面进度条
        },
        before : function(obj) {
          //开始上传时候让进度条去除隐藏状态
          $("#upload_progress").removeClass("layui-hide");
          //或者设置loading
        },
        done : function(res, index, upload) {//在多文件上传中 每次成功将被调用一次
          if (res) {//此处只用于单文件图片的上传，若为多图片多文件请做其他处理
            imgArr.push(res)
            localStorage.setItem('uploadImg',JSON.stringify(imgArr));
            idArr.push(res.id);
            $("#list2").hide();
            $("#list3").show();
            $("#upload_preview").append("<audio src='"+ getAjaxUrl("",res.url) +"'  style='width: 230px;height: 146px;' controls></audio>");
            $("#upload_preview").width(230);
            $("#upload_preview").height(146);
            $("#upload_preview").css('background-image',"url(../../../common/img/u8901.png)")
            $("#upload_preview ").append("<button style='position: absolute;top:5px;right: 5px;background: #000' class='deletePic' class='layui-btn layui-btn-xs'><i class='layui-icon layui-icon-delete' style='color: #FFFFFF'></i></button>")
            $("#counts").text(imgArr.length)
            $('.deletePic').each(function () {
              $(this).click(function () {
                $(this).prev("audio").remove();
                $(this).remove();
              })
            })
            getAudioList(1,{columnId:columnId})
            returnBack6();
          }
        },
        error : function(index, upload) {
          //请求异常回调
          layer.close(layer.index);
          layer.confirm("上传失败，您是否要重新上传？", {
            btn : [ '确定', '取消' ],
            icon : 3,
            title : "提示"
          }, function() {
            //关闭询问框
            layer.closeAll();
            //重新调用上传方法
            uploadFile.upload();
          })
        }
      });
    })
  }

  function edit(){
      var id=idArr.join(",")
      ajax(service_prefix.resources,url+"/"+id,'get').then(function (res) {
          if(res.success){
              layer.closeAll();
              $('#list3').hide();
              $('#list5').show();
              ids=id;
              layui.form.val('audioInfo1',res.obj)

          }
      })
  }
  layui.form.on("submit(confirms1)",function (data) {
      console.log(data.field,ids)
      ajax(service_prefix.resources,url+"/"+ids,"put",JSON.stringify(data.field)).then(function (res) {
          if(res.success){
              $("#list5").hide();
              $("#list1").show();
              getTreeData()
          }
      })
  })

  function returnBack(){
    $("#list1").show();
    $('#list2').hide();
  }
  function returnBack1(){
    $("#list2").show();
    $('#list3').hide();
  }
  function setting(){
      layer.open({
          type: 1 //此处以iframe举例
          ,title: '设置'
          ,area: ['500px', '480px']
          ,shade: 0.3
          ,maxmin: true
          ,content: "<div id='form1'></div>"

      });
      layui.laytpl($("#setForms").html()).render({}, function(html){
          $("#form1").html(html);
          layui.form.render();
      })
      ajax(service_prefix.resources,"/manage/watermark/1190170471144898562","get").then(function (res) {
          if(res.success){
              $("#supForm").val(res.obj.supForm)
          }
      })
      layui.form.verify({
          audioForms: [
              /^(mp3|wma|flac|asf)|.*((mp3|wma|flac|asf)(,mp3|,wma|,flac|,asf))$/,
              '音频格式有误，请输入正确的格式'
          ]
      });
      layui.form.on('radio(mp3Zcode)',function (data) {
          localStorage.setItem("mp3Zcode",data.value);
      })
  }

  function reloadUploadUrl() {
    uploadFile.reload({
      url: getAjaxUrl(service_prefix.resources,'/picture/radioupload?id=' + columnId), //上传接口
    });
  }

  function returnBack2(){
    $("#list3").show();
    $('#list4').hide();
  }
  function returnBack3(){
    $("#list4").show();
    $('#list5').hide();
  }
  function returnBack4(){
    $("#list1").show();
    $('#list6').hide();
  }
  function returnBack5(){
    $("#list1").show();
    $('#list7').hide();
  }
  $("#change2").hover(function(){
    $(this).attr('src','/common/img/u6611_mouseOver.png');
  },function(){
    $(this).attr('src','/common/img/u6611.png');
  })
  $('.img1').click(function(){
    if($(this).find('img').attr('id') == 'change2'){
      $(this).find('img').attr('src','/common/img/u6611_mouseOver.png');
      $('#change1').attr('src','/common/img/u6616.png')
      $(".imgBox").hide()
      $(".imgBox1").show()
    }else if($(this).find('img').attr('id') == 'change1'){
      $(this).find('img').attr('src','/common/img/u6616_mouseOver.png');
      $('#change2').attr('src','/common/img/u6611.png')
      $(".imgBox").show()
      $(".imgBox1").hide()
    }
  })

  layui.use('form', function () { //声明使用layUI的form
    var form = layui.form;
    form.render(); //刷新所有渲染效果，也可以单独熟悉某个效果
    //监听提交
    form.on('submit(formDemo)', function (data) {
      layer.msg(JSON.stringify(data.field));
      return false;
    });
  });

  layui.use('layer', function(){ //独立版的layer无需执行这一句
    var  layer = layui.layer; //独立版的layer无需执行这一句
    //触发事件
    var active = {
      preview:function(){
        layer.msg("<div id='form9'></div>", {
          time:0,
          closeBtn:2,
          shade: 0.3,
          area: ['1300px', '530px']
        });
        layui.laytpl($("#detail").html()).render({}, function(html){
          $("#form9").html(html);
          layui.form.render();
        })
        $('.image').click(function(){ //这个视频被点击后执行
          var img = $(this).attr('vpath');//获取视频预览图
          var video = $(this).attr('ipath');//获取视频路径
          $('.videos').html("<audio id=\"video\" poster='"+img+"' style='width: 795px;height:464px;' src='"+video+"' preload=\"auto\" controlsList=\"nodownload\" controls=\"controls\" autoplay=\"autoplay\"></audio><img onClick=\"close1()\" class=\"vclose\" src=\"gb.png\" width=\"25\" height=\"25\"/>");
          $('.videos').show();
        });

        function close1(){
          var v = document.getElementById('video');//获取视频节点
          $('.videos').hide();//点击关闭按钮关闭暂停视频
          v.pause();
          $('.videos').html();
        }
      },
      delete: function(){
        var that = this;
        //多窗口模式，层叠置顶
        layer.open({
          type: 1 //此处以iframe举例
          ,title: '提示'
          ,area: ['380px', '221px']
          ,shade: 0.3
          ,maxmin: true
          ,content: "<div style='text-align:center;line-height:120px;'>确认要删除？</div>"
          ,btn: ['确定', '取消'] //只是为了演示
          ,btn2: function(){
            layer.closeAll();
          }

        });
      },

      upload: function(){
        if(!bool){
            var that = this;
            //多窗口模式，层叠置顶
            layer.open({
                type: 1 //此处以iframe举例
                ,title: '上传到'
                ,area: ['502px', '452px']
                ,shade: 0.3
                ,maxmin: true
                ,content: "<div id='form'></div>"
                ,btn: ['开始上传', '取消'] //只是为了演示
                ,btn2: function(){
                    layer.closeAll();
                }
                ,yes: function(){
                    if(!columnId){
                        layer.alert("请先选择栏目");
                        return;
                    }
                    layer.closeAll();
                    $("#list1").hide();
                    $('#list2').show();
                }

            });
            layui.laytpl($("#upload").html()).render({}, function(html){
                $("#form").html(html);
                layui.form.render();
            })
            var settingss = {
                data: {
                    simpleData: {
                        enable: true,  //true 、 false 分别表示 使用 、 不使用 简单数据模式
                        idKey: "id",  //节点数据中保存唯一标识的属性名称
                        pIdKey: "parentId",    //节点数据中保存其父节点唯一标识的属性名称
                        rootPId: -1  //用于修正根节点父节点数据，即 pIdKey 指定的属性值
                    },
                    key: {
                        name: "name"  //zTree 节点数据保存节点名称的属性名称  默认值："name"
                    }
                },
                view: {showLine: false, showIcon: true},
                callback: {
                    onClick: zTreeOnClick
                }
            };
            ajax(service_prefix.manage,"/programa/getTreeData","post",{}).then(function(data){
            var nodes = data.obj;
            zTreeObj = $.fn.zTree.init($("#treeDemo1"), settingss, nodes); //初始化树

            zTreeObj.expandAll(true); //true 节点全部展开、false节点收缩

        })
        }else {
            $("#list1").hide();
            $('#list2').show();

            initUploadBtn();
        }
      }
    };
    function zTreeOnClick(event, treeId, treeNode) {

        if(treeNode.level>1){
            columnId =treeNode.id;
        }

      layui.use([ 'layer', 'element', 'form', 'upload' ], function() {
        var layer = layui.layer,
                element = layui.element,
                form = layui.form,
                upload = layui.upload;

        //创建监听函数
        var xhrOnProgress = function(fun) {
          xhrOnProgress.onprogress = fun; //绑定监听
          //使用闭包实现监听绑
          return function() {
            //通过$.ajaxSettings.xhr();获得XMLHttpRequest对象
            var xhr = $.ajaxSettings.xhr();
            //判断监听函数是否为函数
            if (typeof xhrOnProgress.onprogress !== 'function')
              return xhr;
            //如果有监听函数并且xhr对象支持绑定时就把监听函数绑定上去
            if (xhrOnProgress.onprogress && xhr.upload) {
              xhr.upload.onprogress = xhrOnProgress.onprogress;
            }
            return xhr;
          }
        }
        var idArr=[];
          var form="mp3|wma|flac";
          var form1=localStorage.getItem("audioForm").split(",").join("|")+"|"+form;
          var supForm=form1||form
          reloadUploadUrl();
      })

    }
    $('.layui-btn').click(function(event){
      event.stopPropagation();
      var othis = $(this), method = othis.data('method');
      active[method] ? active[method].call(this, othis) : '';
    });
    $('.img').click(function(){
      var othis = $(this), method = othis.data('method');
      active[method] ? active[method].call(this, othis) : '';
    });
  });
</script>
<script type="text/html" id="tips">
  <div style="text-align: center;margin-top: 40px">已进入转码任务，请在转码管理进行查看</div>
  <div class="layui-btn-container" style="margin: 40px 0px 0  120px">
    <button class="layui-btn " onclick="look()">查看</button>
    <button class="layui-btn  layui-btn-primary" onclick="layer.closeAll()">取消</button>
  </div>
</script>
<script type="text/html" id="setForms">
  <form class="layui-form" style="margin-top: 10px;">
    <div class="layui-form-item">
      <label class="layui-form-label" style="padding:  9px 0px 9px 25px;text-align: left">格式</label>
      <div class="layui-input-block" style="width: 330px;margin-left: 136px">
        <input type="text" class="layui-input" autocomplete="off" value="mp3,wma,flac" name="supForm" lay-verify="audioForms" id="supForm">
      </div>
    </div>
    <div class="layui-form-item">
      <label class="layui-form-label" style="padding:  9px 0px 9px 25px;text-align: left;width: 110px">数字音频接口</label>
      <div class="layui-input-block" style="width: 330px;margin-left: 136px">
        <select name="" id="">
          <option value="" selected>家用标准</option>
          <option value="">专业标准</option>
          <option value="">电脑标准</option>
        </select>
      </div>
    </div>
    <div class="layui-form-item">
      <label class="layui-form-label" style="padding:  9px 0px 9px 25px;text-align: left">视听技术</label>
      <div class="layui-input-block" style="width: 330px;margin-left: 136px">
        <select name="" id="">
          <option value="" selected>CD</option>
          <option value="">VCD</option>
          <option value="">MD</option>
        </select>
      </div>
    </div>
    <div class="layui-form-item">
      <label class="layui-form-label" style="padding:  9px 0px 9px 25px;text-align: left;width: 110px">默认MP3转码：</label>
      <div class="layui-input-block" style="width: 300px;margin-left: 140px;">
        <input type="radio" name="sex" value="是" title="是" lay-filter="mp3Zcode">
        <input type="radio" name="sex" value="否" title="否" lay-filter="mp3Zcode">
      </div>
    </div>
    <div class="layui-form-item">
      <label class="layui-form-label" style="padding:  9px 0px 9px 25px;width:110px;text-align: left;">音频信息抽取:</label>
      <div class="layui-input-block" style="width: 300px;margin-left: 140px;">
        <input type="radio"  name="sex" value="是" title="是" lay-filter="picInfo">
        <input type="radio"   name="sex"value="否" title="否" lay-filter="picInfo" checked>
      </div>
    </div>
    <div class="layui-form-item">
      <label class="layui-form-label" style="padding:  9px 0px 9px 25px;text-align: left">*版权所有</label>
      <div class="layui-input-block" style="width: 330px;margin-left: 136px" id="copyright">
        <select name="copyright" id="">
          <option value="自主">自主</option>
          <option value="原创">原创</option>
          <option value="经授权">经授权</option>
        </select>
      </div>
    </div>
    <div class="layui-btn-container" style="margin: 35px 160px;">
      <button class="layui-btn" type="button" lay-submit lay-filter="saveSettings">确定</button>
      <button class="layui-btn layui-btn-primary" onclick="layer.closeAll()" type="button">取消</button>
    </div>
  </form>
</script>
<script type="text/html" id='upload'>
  <div class='treeBox' style='margin:15px 35px;border:1px solid #f5f5f5;width:428px;height:317px;'>
    <ul id="treeDemo1" class="ztree"  style="width: 428px;height: 317px;"></ul>
  </div>
</script>
<script type="text/html" id='detail'>
  <div class='prev1' style="position: absolute;top: 290px;left: 20px">
    <button class="layui-btn layui-btn-sm" title="上一条音频" onclick="prev1()" id="prev"><i class='layui-icon layui-icon-left'></i></button>
  </div>
  <div class='next1' style="position: absolute;top: 290px;left: 680px">
    <button class="layui-btn layui-btn-sm" title="下一条音频" onclick="next()"><i class='layui-icon layui-icon-right'></i></button>
  </div>
  <div class='box'>
    <div class='left'>
      <div class='image' style='position:relative;'>
        <img src="../../../common/img/u8901.png" alt="" style="width: 100%;height:100%">
        {{#if(d.mp3url){
          var url = getAjaxUrl("",d.mp3url);
        }}
        <audio src="{{url}}" preload="auto" controlsList="nodownload" controls="controls" autoplay="autoplay"
        style="position: absolute;left:200px;bottom:15px;"></audio>
        {{#} else if(!d.mp3url){
          var url = getAjaxUrl("",d.url);
        }}
        <audio src="{{url}}" preload="auto" controlsList="nodownload" controls="controls" autoplay="autoplay"
               style="position: absolute;left:200px;bottom:15px;"></audio>
        {{#} }}

      </div>
    </div>
    <div class='rights' style="overflow: hidden">
      <button class="layui-btn" style="position: absolute;right:20px;top:20px" onclick="returnBack6()">返回</button>
      <div class="layui-tab">
        <ul class="layui-tab-title">
          <li class="layui-this">基本信息</li>
          <li id="heads1" style="display: none">详细信息</li>
        </ul>
        <div class="layui-tab-content">
          <div class="layui-tab-item layui-show">
            <div class='layui-btn-container' style='margin-top:35px;'>
              <button class="layui-btn layui-btn-sm layui-btn-normal "
              >{{#if(d.collection===0){ }}
                <img src="../../../common/img/u582.png" alt="" onclick="collect('{{d.id}}',event)" style="    width: 25px;
    height: 25px;
    margin-top: 3px;" >
                {{#} else if(d.collection===1){ }}
                <img src="../../../common/img/u582_mouseOver.png" alt="" onclick="collect('{{d.id}}',event)" style="    width: 25px;
    height: 25px;
    margin-top: 3px;" >
                {{#} }}</button>
              <button class='layui-btn layui-btn-normal layui-btn-sm'style='margin-left:0px;' onclick="downLoadAudio('{{d.id}}',event)">立即下载</button>
              <button class='layui-btn layui-btn-normal layui-btn-sm' style='margin-left:20px;' onclick="deleteAudios('{{d.id}}',event)"><i class='layui-icon layui-icon-delete'></i></button>
            </div>
            <p style='margin-top:20px; color:#666;text-align:left;'>名称：{{d.name}}</p>
            <p style='margin-top:10px; color:#666;text-align:left'>大小：{{d.fsize}}KB</p>
            <p style='margin-top:10px; color:#666;text-align:left'>格式：{{d.form}}</p>
            <p style='margin-top:10px; color:#666;text-align:left'>上传时间：{{d.createTime}}</p>
            <p style='margin-top:10px; color:#666;text-align:left'>路径：{{d.url}}</p>
            <p style='margin-top:10px; color:#666;text-align:left'>来源：{{d.resc}}</p>
            <p style='margin-top:10px; color:#666;text-align:left;overflow: hidden'>版权所属：{{d.copyright}}</p>
            <p style='margin-top:10px; color:#666;text-align:left;overflow: hidden'>创建者：{{d.crUser}}</p>
            {{#if(d.status===0){ }}
            <p style='margin-top:10px; color:#666;text-align:left'>音频状态：新稿</p>
            {{#} else if(d.status===10){ }}
            <p style='margin-top:10px; color:#666;text-align:left'>音频状态：审核</p>
            {{#} else if(d.status===20){ }}
            <p style='margin-top:10px; color:#666;text-align:left'>音频状态：发布</p>
            {{#} }}
            <div class="layui-btn-container" style="margin-top: 20px;">
              {{#if(d.status!=10){ }}
              <button class='layui-btn' onclick="changeState('审核','{{d.id}}')">审核</button>
              {{#} }}
              {{#if(d.status!=20){ }}
              <button class='layui-btn'  onclick="changeState('发布','{{d.id}}')">发布
                {{#} }}
                <button class='layui-btn layui-btn-danger' onclick="update('{{d.id}}')">修改</button>
            </div>
          </div>
          <div class="layui-tab-item">
            <form class="layui-form" style="height: 614px;margin-top: 20px" lay-filter="detailInfo">
              <div class="layui-form-item">
                <label class="layui-form-label" style="width: 100px;padding: 9px 0">比特率</label>
                <div class="layui-input-block">
                  <input type="text" class="layui-input" id="detai1" disabled style="border: none">
                </div>
              </div>
              <div class="layui-form-item">
                <label class="layui-form-label" style="width: 100px;padding: 9px 0">音轨长度</label>
                <div class="layui-input-block">
                  <input type="text" class="layui-input" id="detai2" disabled style="border: none">
                </div>
              </div>
              <div class="layui-form-item">
                <label class="layui-form-label" style="width: 100px;padding: 9px 0">声道</label>
                <div class="layui-input-block">
                  <input type="text" class="layui-input" id="detai3" disabled style="border:none">
                </div>
              </div>
              <div class="layui-form-item">
                <label class="layui-form-label" style="width: 100px;padding: 9px 0">采样率</label>
                <div class="layui-input-block">
                  <input type="text" class="layui-input" id="detai4" disabled style="border: none">
                </div>
              </div>
            </form>
          </div>
        </div>
      </div>

    </div>
  </div>
  </div>
  <!--<div class='next'>-->
    <!--<i class='layui-icon layui-icon-right'></i>-->
  <!--</div>-->
</script>
<script>
  // layui.use('layer', function(){ //独立版的layer无需执行这一句
  //     var  layer = layui.layer; //独立版的layer无需执行这一句
var ids="";
layui.form.on("submit(saveSettings)",function (data) {
    localStorage.setItem("audioForm",data.field.supForm)
    layer.closeAll();
    return false;
})
  function returnBack6(){
      $("#list1").show();
      $('#form9').hide();
    $("audio").attr("src","");
  }
  form.on('radio(picInfo)', function(data){

      localStorage.setItem("picInfo2",data.value)
  });
  function update(id){
      ajax(service_prefix.resources,url+"/"+id,'get').then(function (res) {
          if(res.success){
              $("#form9").hide();
              $("audio").attr("src","");
              $("#list7").show();
              ids=id;
              layui.laytpl($("#inner").html()).render(res.obj, function(html){
                  $("#inner5").html(html);
                  layui.form.val('audioInfo',res.obj)
              })

          }
      })
  }
  layui.form.on("submit(confirms)",function (data) {
      console.log(data.field,ids)
      ajax(service_prefix.resources,url+"/"+ids,"put",JSON.stringify(data.field)).then(function (res) {
          if(res.success){
              $("#list7").hide();
              $("#list1").show();
              getTreeData()
          }
      })
  })
</script>
<script type="text/html" id="inner">
  <div class='left' style="width: 700px;height:500px;background: #f5f5f5;padding: 20px;margin-top: 40px;display: inline-block">
    <div class='image' style="height: 484px;width: 695px;position: relative;">
      <img src="../../../common/img/u8901.png" alt="" style="width: 100%;height:100%">
      {{#if(d.mp3url){
        var url = getAjaxUrl("",d.mp3url);
      }}
      <audio src="{{url}}" preload="auto" controlsList="nodownload" controls="controls" autoplay="autoplay"
             style="position: absolute;left:200px;bottom:15px;"></audio>
      {{#} else if(!d.mp3url){
        var url = getAjaxUrl("",d.url);
      }}
      <audio src="{{url}}" preload="auto" controlsList="nodownload" controls="controls" autoplay="autoplay"
             style="position: absolute;left:200px;bottom:15px;"></audio>
      {{#} }}

    </div>
  </div>
  <div class="infoBox" style="width: 450px;height:630px;border-left:1px solid #ccc;position: absolute;top:40px;right:0;">
    <form class="layui-form" id='form3' lay-filter="audioInfo">
      <button class="layui-btn layui-btn-normal" style="width: 310px;margin:20px 0 20px 50px;" lay-submit lay-filter="confirms" type="button">确定</button>
      <div class="layui-form-item">
        <label class="layui-form-label" style="text-align: left;">音频名称</label>
        <div class="layui-input-block" style="width:320px;">
          <input type="text" class="layui-input" placeholder="请输入内容" name="name">
        </div>
      </div>
      <div class="layui-form-item">
        <label class="layui-form-label" style="text-align: left;">*版权归属</label>
        <div class="layui-input-block" style="width:320px;">
          <input type="text" class="layui-input" name="copyright">
        </div>
      </div>
      <div class="layui-form-item">
        <label class="layui-form-label" style="text-align: left;">来源</label>
        <div class="layui-input-block" style="width:320px;">
          <input type="text" class="layui-input" placeholder="请输入内容" name="resc">
        </div>
      </div>
      <div class="layui-form-item">
        <label class="layui-form-label" style="text-align: left;">*描述</label>
        <div class="layui-input-block" style="width:320px;">
          <textarea class="layui-textarea" style="border: 1px solid #ccc" name="description"></textarea>
        </div>
      </div>
      <div class="layui-form-item">
        <label class="layui-form-label" style="text-align: left;">文件夹路径</label>
        <div class="layui-input-block" style="width:320px;">
          <input type="text" class="layui-input" placeholder="请输入内容" name="url">
        </div>
      </div>
      <div class="layui-form-item">
        <label class="layui-form-label" style="text-align: left;">格式</label>
        <div class="layui-input-block" style="width:320px;">
          <select name="form" id="">
            <option value="mp3" selected>MP3</option>
            <option value="wav">WAV</option>
            <option value="asf">ASF</option>
          </select>
        </div>
      </div>
      <div class="layui-form-item">
        <label class="layui-form-label" style="text-align: left;">文件大小</label>
        <div class="layui-input-block" style="width:320px;">
          <input type="text" class="layui-input" name="fsize">
        </div>
      </div>
      <div class="layui-form-item">
        <label class="layui-form-label" style="text-align: left;">时长</label>
        <div class="layui-input-block" style="width:320px;">
          <input type="text" class="layui-input" name="length">
        </div>
      </div>
      <div class="layui-form-item">
        <label class="layui-form-label" style="text-align: left;">上传时间</label>
        <div class="layui-input-block" style="width:320px;">
          <input type="text" class="layui-input" name="createTime">
        </div>
      </div>
    </form>

  </div>
</script>

<script type="text/html" id="columnDetailTpl">
  <button class="layui-btn" type="button" onclick="editColumn('{{d.id}}')">修改栏目</button>
  <table class="layui-table" style="width: 75%" lay-even="" lay-skin="row" id="info">
    <colgroup>
      <col width="20%">
      <col width="">
      <col>
    </colgroup>
    <tbody>
    <tr>
      <td>状态：</td>
      <td>{{d.status==0?"启用":"停用"}}</td>
    </tr>
    <tr>
      <td>所属站点：</td>
      <td id="columnSiteName"></td>
    </tr>
    <tr>
      <td>唯一标识：</td>
      <td>{{d.skuNumber}}</td>
    </tr>
    <tr>
      <td>栏目名称：</td>
      <td>{{d.name}}</td>
    </tr>
    <tr>
      <td>首页展示模板：</td>
      <td style="cursor: pointer;" onclick="editTemplate('{{d.listtpl}}')">{{d.listtplName}}</td>
    </tr>
    <tr>
      <td>细览编辑模板：</td>
      <td style="cursor: pointer;" onclick="editTemplate('{{d.edittpl}}')">{{d.edittplName}}</td>
    </tr>
    <tr>
      <td>细览展示模板：</td>
      <td style="cursor: pointer;" onclick="editTemplate('{{d.detailtpl}}')">{{d.detailtplName}}</td>
    </tr>
    <tr>
      <td>元数据名称：</td>
      <td style="cursor: pointer;" id="columnTableName" onclick="showTab('metadataFieldTab');"></td>
    </tr>
    <tr>
      <td>发布地址：</td>
      <td><a target="_blank" href="/pub{{d.chnlDataPath}}/list.html">/pub{{d.chnlDataPath}}/list.html</a></td>
    </tr>
    </tbody>
  </table>
</script>
<script type="text/html" id="templetTpl">
  <form class="layui-form" lay-filter="templetForm">
    <div class="layui-card">
      <div class="layui-card-body" style="padding: 25px 15px;    height: 780px;">

        <div class="layui-form-item form-item-inline" style="width: 500px">
          <label class="layui-form-label">模板名称:</label>
          <div class="layui-input-block">
            <input type="text" name="tempname" placeholder="请输入" autocomplete="off" class="layui-input">
          </div>
        </div>
        <div class="layui-form-item form-item-inline">
          <label class="layui-form-label">模板类型:</label>
          <div class="layui-input-block">
            <select name="temptype" class="layui-input" required lay-verify="required">
              <option value="1">概览模板</option>
              <option value="2">细览模板</option>
              <option value="3">嵌套模板</option>
            </select>
          </div>
        </div>
        <div class="layui-form-item form-item-inline">
          <label class="layui-form-label">输出文件名:</label>
          <div class="layui-input-block">
            <input type="text" name="outputfilename" placeholder="请输入" autocomplete="off" class="layui-input">
          </div>
        </div>
        <div class="layui-form-item form-item-inline">
          <label class="layui-form-label">扩展名:</label>
          <div class="layui-input-block">
            <input type="text" name="tempext" placeholder="请输入" autocomplete="off" class="layui-input">
          </div>
        </div>
        <div class="layui-form-item form-item-inline">
          <label class="layui-form-label">站点:</label>
          <div class="layui-input-block">
            <span>{{d.siteName}}</span>
          </div>
        </div>
        <div class="layui-form-item" >
          <label class="layui-form-label">模板描述:</label>
          <div class="layui-input-block" style="display: inline-block;margin-left: 0">
            <textarea class="layui-textarea" style="height: 55px;min-height: 0;width: 1010px;" name="tempdesc"></textarea>
          </div>
          <div class="layui-upload" style="    position: absolute;display: inline-block;
    margin-left: 50px;
    margin-top: 12px;">
            <button type="button" class="layui-btn" id="test1" style="display: inline-block">上传模板缩略图</button>
            <div class="layui-upload-list" style="display: inline-block;position: absolute;
    left: 140px;
    top: -20px;    height: 50px;
    width: 120px;
    border: 1px solid;
    margin-left: 10px">
              <img class="layui-upload-img" id="demos1" style="width: 100%;height: 100%">
              <p id="demoText"></p>
            </div>
          </div>
        </div>
        <div class="layui-form-item">
          <label class="layui-form-label">模板文本:</label>
          <div class="layui-input-block">
            <textarea class="layui-textarea" style="height: 673px;padding-top: 7px;line-height: 18px!important;" name="temphtml" id="text1"></textarea>
          </div>
        </div>

      </div>
    </div>
    <div class="button-bar">
      <button class="layui-btn" lay-submit lay-filter="addTemplet">提交</button>
      <button class="layui-btn" type="button" data-type="close">返回</button>
    </div>
    <input type="hidden" name="id">
    <input type="hidden" name="siteid">
  </form>
</script>
<script type="text/html" id="columnTpl">
  <form class="layui-form" lay-filter="columnForm">
    <div class="layui-card-body">
      <div class="layui-form-item">
        <label class="layui-form-label">状态:</label>
        <div class="layui-input-block">
          <input type="radio" name="stop" checked value="0" title="启用">
          <input type="radio" name="stop" value="1" title="停用">
        </div>
      </div>
      <div class="layui-form-item">
        <label class="layui-form-label">所属站点:</label>
        <div class="layui-input-block">
          <span>{{d.siteName}}</span>
        </div>
      </div>
      <div class="layui-form-item">
        <label class="layui-form-label">父栏目:</label>
        <div class="layui-input-block">
          <span>{{d.parentName}}</span>
        </div>
      </div>
      <div class="layui-form-item">
        <label class="layui-form-label">栏目类型:</label>
        <div class="layui-input-block">
          <select name="" class="layui-input" required lay-verify="required">
            <option value="1">普通栏目</option>
            <option value="2">图片新闻</option>
            <option value="3">头条栏目</option>
            <option value="4">链接栏目</option>
          </select>
        </div>
      </div>
      <div class="layui-form-item">
        <label class="layui-form-label">唯一标识:</label>
        <div class="layui-input-block">
          <input type="text" name="skuNumber" required lay-verify="required" placeholder="请输入"
                 autocomplete="off" class="layui-input">
        </div>
      </div>
      <div class="layui-form-item">
        <label class="layui-form-label">栏目名称:</label>
        <div class="layui-input-block">
          <input type="text" name="name" required lay-verify="required" placeholder="请输入"
                 autocomplete="off" class="layui-input">
        </div>
      </div>
      <div class="layui-form-item">
        <label class="layui-form-label">前一个栏目:</label>
        <div class="layui-input-block">
          <select class="layui-input" id="chnlOrder" name="chnlOrder">
          </select>
        </div>
      </div>
      <input type="hidden" name="id">
      <div class="button-bar">
        <button type="button" class="layui-btn" lay-submit lay-filter="addColumn">确定</button>
        <button type="button" class="layui-btn layui-btn-primary" onclick="layer.closeAll();">取消</button>
      </div>
    </div>
    <input type="hidden" name="siteId">
    <input type="hidden" name="parentId">
    <input type="hidden" name="id">
  </form>
</script>
<script type="text/html" id="columnListTmpl">
  {{#layui.each(d, function(index, item){}}
  <li id="{{item.id}}" order="{{item.chnlOrder}}">
    <form class="layui-form" action="">
      <div class="layui-form-item" pane="">
        <div class="layui-input-block">
          <input type="checkbox" name="ids" lay-skin="primary" id="check" value="{{item.id}}">
        </div>
      </div>
      <div class="chanelName">{{item.name}}</div>
    </form>
    <div class="bottom">
      <img src="../../../common/img/u5722.png" alt="" onclick="editColumn('{{item.id}}')">
      <img src="../../../common/img/u5725.png" alt="" onclick="getColumnById('{{item.id}}')">
      <img onclick="delColumn1('{{item.id}}',1)" src="../../../common/img/u5729.png" alt="" srcset="">
    </div>
  </li>
  {{#}) }}
  <li>
    <button onclick="addImgColumn()" type="button" class="layui-btn"></button>
  </li>
</script>


<!-- 新加审核功能 -->
<script type="text/html" id="shTemplate">
  <form action="" class='layui-form'>
    <div class="layui-form-item">
      <label class="layui-form-label">审核状态：</label>
       <div class="layui-input-block">
          <input type="radio" name="sex" value="审核通过" title="审核通过" checked="">
          <input type="radio" name="sex" value="审核不通过" title="审核不通过">
      </div>
    </div>
    <label class="layui-form-label">审核理由：</label>
    <textarea name="" id="reson" rows=6 cols=30 placeholder="请输入描述理由"  ></textarea>
  </form>
</script>

<script>
  $("#passAll").click(function (data) {
    layer.open({
      title: '审核',
      area: ['500px', '300px'],
      content: '<div class="drwb"></div>',
      btn: ['确定', '取消'],
      yes: function (index, layero) {
        console.log(1)
        layer.close(index);
      },
      btn2: function (index, layero) {
        layer.close(index);
      },
      cancel: function (index, layero) {
        layer.close(index);
      }
    })
    layui.laytpl($("#shTemplate").html()).render(data, function (html) {
      $(".drwb").html(html)
      setRender();
    });
  })
</script>


<!-- 转发功能 -->
<script type="text/html" id="tuisongTemplate">
  <form action="" class="layui-form">
    <p>请选择推送渠道:</p>
    <div class="layui-inline">
      <div class="layui-input-block"><select name="">
          <option value="">请选择</option>
          <option value="">推送到网站渠道</option>
          <option value="">推送到第三方渠道</option>
        </select></div>
    </div>
    <p>请选择推送站点:</p>
    <div class="layui-inline">
      <div class="layui-input-block"><select name="">
          <option value="">请选择</option>
          <option value="">中科聚网公众号</option>
          <option value="">中科聚网微博号</option>
        </select></div>
    </div>
  </form>
</script>

<script>
  $("#unpassAll").click(function (data) {
    layer.open({
      title: '推送',
      area: ['500px', '320px'],
      content: '<div class="tuisong"></div>',
      btn: ['确定', '取消'],
      yes: function (index, layero) {
        console.log(1)
        layer.close(index);
      },
      btn2: function (index, layero) {
        layer.close(index);
      },
      cancel: function (index, layero) {
        layer.close(index);
      }
    })
    layui.laytpl($("#tuisongTemplate").html()).render(data, function (html) {
      $(".tuisong").html(html)
      setRender();
    });
  })





  function addImgColumn() {
    var thisNode = global.zTreeObj.getSelectedNodes()[0];
    var pName = thisNode.isSite==2?thisNode.name:"跟路径";
    var nodes = thisNode.getPath();
    var siteName;
    var siteId;
    for(var res of nodes){
      if (res.isSite == 1) {
        siteId = res.id;
        siteName = res.name;
        break;
      }
    }
    showColumnDiv2({parentId: thisNode.isSite==2?thisNode.id:0, siteId: siteId}, thisNode.level, pName, siteName);
  }
</script>
</body>

</html>